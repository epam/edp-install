<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Starting from Keycloak v.18.x.x, the Keycloak server has been moved from the Wildfly (JBoss) Application Server to Quarkus framework and is called Keycloak.X."><link href=https://epam.github.io/edp-install/operator-guide/upgrade-keycloak-19.0/ rel=canonical><link href=../upgrade-edp-3.1/ rel=prev><link href=../../user-guide/terraform-stages/ rel=next><link rel=icon href=../../assets/favicon.png><meta name=generator content="mkdocs-1.5.3, mkdocs-material-9.5.7"><title>v17.0 to 19.0 - EPAM Delivery Platform</title><link rel=stylesheet href=../../assets/stylesheets/main.f2e4d321.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css><link rel=stylesheet href=../../stylesheets/extra.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-7ZV6PJ2LSP"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-7ZV6PJ2LSP",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-7ZV6PJ2LSP",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script><script>var consent;"undefined"==typeof __md_analytics||(consent=__md_get("__consent"))&&consent.analytics&&__md_analytics()</script><meta name=msvalidate.01 content=0A0BD75C41E23DEE0C6F5DB33E1BECBC></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=cyan data-md-color-accent=blue> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#upgrade-keycloak-v170-to-190 class=md-skip> Skip to content </a> </div> <div data-md-component=announce> <aside class=md-banner> <div class="md-banner__inner md-grid md-typeset"> EDP Team Supports Ukraine ðŸ‡ºðŸ‡¦<br> We have migrated our documentation to the new domain <a href="https://docs.kuberocketci.io?utm_source=epam.github.io&utm_medium=referral" target=_blank>https://docs.kuberocketci.io</a>. Please use this link for accessing the latest documentation. </div> </aside> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="EPAM Delivery Platform" class="md-header__button md-logo" aria-label="EPAM Delivery Platform" data-md-component=logo> <img src=../../assets/logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> EPAM Delivery Platform </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> v17.0 to 19.0 </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=cyan data-md-color-accent=blue aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg> </label> </form> <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/epam/edp-install title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../overview/ class=md-tabs__link> Getting Started </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../ class=md-tabs__link> Operator Guide </a> </li> <li class=md-tabs__item> <a href=../../user-guide/ class=md-tabs__link> User Guide </a> </li> <li class=md-tabs__item> <a href=../../developer-guide/ class=md-tabs__link> Developer Guide </a> </li> <li class=md-tabs__item> <a href=../../use-cases/ class=md-tabs__link> Use Cases </a> </li> <li class=md-tabs__item> <a href=../../pricing/ class=md-tabs__link> Pricing </a> </li> <li class=md-tabs__item> <a href=../../roadmap/ class=md-tabs__link> RoadMap </a> </li> <li class=md-tabs__item> <a href=https://github.com/epam/edp-install/blob/master/RELEASES.md class=md-tabs__link> Releases â§‰ </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="EPAM Delivery Platform" class="md-nav__button md-logo" aria-label="EPAM Delivery Platform" data-md-component=logo> <img src=../../assets/logo.png alt=logo> </a> EPAM Delivery Platform </label> <div class=md-nav__source> <a href=https://github.com/epam/edp-install title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex> <span class=md-ellipsis> Getting Started </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Getting Started </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../overview/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2> <label class=md-nav__link for=__nav_2_2 id=__nav_2_2_label tabindex> <span class=md-ellipsis> Quick Start </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2> <span class="md-nav__icon md-icon"></span> Quick Start </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../quick-start/quick-start-overview/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2_2> <label class=md-nav__link for=__nav_2_2_2 id=__nav_2_2_2_label tabindex=0> <span class=md-ellipsis> CI Pipelines - Build </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_2_2_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2_2> <span class="md-nav__icon md-icon"></span> CI Pipelines - Build </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../quick-start/platform-installation/ class=md-nav__link> <span class=md-ellipsis> Install EDP </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2_2_2> <label class=md-nav__link for=__nav_2_2_2_2 id=__nav_2_2_2_2_label tabindex=0> <span class=md-ellipsis> Integrate Tools </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_2_2_2_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2_2_2> <span class="md-nav__icon md-icon"></span> Integrate Tools </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../quick-start/integrate-sonarcloud/ class=md-nav__link> <span class=md-ellipsis> Integrate SonarQube </span> </a> </li> <li class=md-nav__item> <a href=../../quick-start/integrate-github/ class=md-nav__link> <span class=md-ellipsis> Integrate GitHub </span> </a> </li> <li class=md-nav__item> <a href=../../quick-start/integrate-container-registry/ class=md-nav__link> <span class=md-ellipsis> Integrate DockerHub </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../quick-start/create-application/ class=md-nav__link> <span class=md-ellipsis> Create Application </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2_3> <label class=md-nav__link for=__nav_2_2_3 id=__nav_2_2_3_label tabindex=0> <span class=md-ellipsis> CD Pipelines - Deploy </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_2_2_3_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2_3> <span class="md-nav__icon md-icon"></span> CD Pipelines - Deploy </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../quick-start/integrate-argocd/ class=md-nav__link> <span class=md-ellipsis> Integrate Argo CD </span> </a> </li> <li class=md-nav__item> <a href=../../quick-start/deploy-application/ class=md-nav__link> <span class=md-ellipsis> Deploy Application </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../features/ class=md-nav__link> <span class=md-ellipsis> Basic Concepts </span> </a> </li> <li class=md-nav__item> <a href=../../glossary/ class=md-nav__link> <span class=md-ellipsis> Glossary </span> </a> </li> <li class=md-nav__item> <a href=../../supported-versions/ class=md-nav__link> <span class=md-ellipsis> Supported Versions and Compatibility </span> </a> </li> <li class=md-nav__item> <a href=../../compliance/ class=md-nav__link> <span class=md-ellipsis> Compliance </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex> <span class=md-ellipsis> Operator Guide </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=true> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Operator Guide </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2> <label class=md-nav__link for=__nav_3_2 id=__nav_3_2_label tabindex> <span class=md-ellipsis> Installation </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> Installation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../installation-overview/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../add-ons-overview/ class=md-nav__link> <span class=md-ellipsis> Install via Add-Ons </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2_3> <label class=md-nav__link for=__nav_3_2_3 id=__nav_3_2_3_label tabindex=0> <span class=md-ellipsis> Install via Helm Chart </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_2_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2_3> <span class="md-nav__icon md-icon"></span> Install via Helm Chart </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2_3_1> <label class=md-nav__link for=__nav_3_2_3_1 id=__nav_3_2_3_1_label tabindex=0> <span class=md-ellipsis> Prerequisites </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_3_2_3_1_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2_3_1> <span class="md-nav__icon md-icon"></span> Prerequisites </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../prerequisites/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2_3_1_2> <label class=md-nav__link for=__nav_3_2_3_1_2 id=__nav_3_2_3_1_2_label tabindex=0> <span class=md-ellipsis> Setup Cluster </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=5 aria-labelledby=__nav_3_2_3_1_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2_3_1_2> <span class="md-nav__icon md-icon"></span> Setup Cluster </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../kubernetes-cluster-settings/ class=md-nav__link> <span class=md-ellipsis> Set Up Kubernetes </span> </a> </li> <li class=md-nav__item> <a href=../openshift-cluster-settings/ class=md-nav__link> <span class=md-ellipsis> Set Up OpenShift </span> </a> </li> <li class=md-nav__item> <a href=../install-ingress-nginx/ class=md-nav__link> <span class=md-ellipsis> Install NGINX Ingress Controller </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../install-argocd/ class=md-nav__link> <span class=md-ellipsis> Install Argo CD </span> </a> </li> <li class=md-nav__item> <a href=../install-tekton/ class=md-nav__link> <span class=md-ellipsis> Install Tekton </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../install-edp/ class=md-nav__link> <span class=md-ellipsis> Install KubeRocketCI </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../aws-marketplace-install/ class=md-nav__link> <span class=md-ellipsis> Install via AWS </span> </a> </li> <li class=md-nav__item> <a href=../install-via-civo/ class=md-nav__link> <span class=md-ellipsis> Install via Civo </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2_6> <label class=md-nav__link for=__nav_3_2_6 id=__nav_3_2_6_label tabindex=0> <span class=md-ellipsis> Advanced Installation </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_2_6_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2_6> <span class="md-nav__icon md-icon"></span> Advanced Installation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../advanced-installation-overview/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../install-harbor/ class=md-nav__link> <span class=md-ellipsis> Install Harbor </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2_6_3> <label class=md-nav__link for=__nav_3_2_6_3 id=__nav_3_2_6_3_label tabindex=0> <span class=md-ellipsis> Multi-Tenancy </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_3_2_6_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2_6_3> <span class="md-nav__icon md-icon"></span> Multi-Tenancy </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../overview-multi-tenancy/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../capsule/ class=md-nav__link> <span class=md-ellipsis> Integrate Capsule </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../install-keycloak/ class=md-nav__link> <span class=md-ellipsis> Install Keycloak </span> </a> </li> <li class=md-nav__item> <a href=../install-defectdojo/ class=md-nav__link> <span class=md-ellipsis> Install DefectDojo </span> </a> </li> <li class=md-nav__item> <a href=../install-reportportal/ class=md-nav__link> <span class=md-ellipsis> Install ReportPortal </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_3> <label class=md-nav__link for=__nav_3_3 id=__nav_3_3_label tabindex> <span class=md-ellipsis> Configuration </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> Configuration </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../edp-access-model/ class=md-nav__link> <span class=md-ellipsis> KubeRocketCI Access Model </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_3_2> <label class=md-nav__link for=__nav_3_3_2 id=__nav_3_3_2_label tabindex=0> <span class=md-ellipsis> Version Control Systems </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_3_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_3_2> <span class="md-nav__icon md-icon"></span> Version Control Systems </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../vcs/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../import-strategy-tekton/ class=md-nav__link> <span class=md-ellipsis> Integrate GitHub/GitLab in Tekton </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../headlamp-oidc/ class=md-nav__link> <span class=md-ellipsis> Headlamp OIDC </span> </a> </li> <li class=md-nav__item> <a href=../namespace-management/ class=md-nav__link> <span class=md-ellipsis> Manage Namespace </span> </a> </li> <li class=md-nav__item> <a href=../customize_deployment/ class=md-nav__link> <span class=md-ellipsis> Customize Deployment </span> </a> </li> <li class=md-nav__item> <a href=../eks-oidc-integration/ class=md-nav__link> <span class=md-ellipsis> EKS OIDC Integration </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_3_7> <label class=md-nav__link for=__nav_3_3_7 id=__nav_3_3_7_label tabindex=0> <span class=md-ellipsis> Jira </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_3_7_label aria-expanded=false> <label class=md-nav__title for=__nav_3_3_7> <span class="md-nav__icon md-icon"></span> Jira </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../jira-integration/ class=md-nav__link> <span class=md-ellipsis> Adjust Jira Integration </span> </a> </li> <li class=md-nav__item> <a href=../jira-gerrit-integration/ class=md-nav__link> <span class=md-ellipsis> Adjust VCS Integration With Jira </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_4> <label class=md-nav__link for=__nav_3_4 id=__nav_3_4_label tabindex> <span class=md-ellipsis> Integration </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_4_label aria-expanded=false> <label class=md-nav__title for=__nav_3_4> <span class="md-nav__icon md-icon"></span> Integration </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_4_1> <label class=md-nav__link for=__nav_3_4_1 id=__nav_3_4_1_label tabindex=0> <span class=md-ellipsis> Tekton </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_4_1_label aria-expanded=false> <label class=md-nav__title for=__nav_3_4_1> <span class="md-nav__icon md-icon"></span> Tekton </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../tekton-overview/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../tekton-monitoring/ class=md-nav__link> <span class=md-ellipsis> Monitoring </span> </a> </li> <li class=md-nav__item> <a href=../notification-msteams/ class=md-nav__link> <span class=md-ellipsis> MS Teams Notification </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_4_2> <label class=md-nav__link for=__nav_3_4_2 id=__nav_3_4_2_label tabindex=0> <span class=md-ellipsis> Container Registry </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_4_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_4_2> <span class="md-nav__icon md-icon"></span> Container Registry </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../container-registries/ class=md-nav__link> <span class=md-ellipsis> Change Container Registry </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_4_2_2> <label class=md-nav__link for=__nav_3_4_2_2 id=__nav_3_4_2_2_label tabindex=0> <span class=md-ellipsis> Harbor </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_3_4_2_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_4_2_2> <span class="md-nav__icon md-icon"></span> Harbor </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../container-registry-harbor-integration-tekton-ci/ class=md-nav__link> <span class=md-ellipsis> Harbor Integration </span> </a> </li> <li class=md-nav__item> <a href=../harbor-oidc/ class=md-nav__link> <span class=md-ellipsis> OIDC in Harbor </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../package-registry/ class=md-nav__link> <span class=md-ellipsis> Package Registry </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_4_4> <label class=md-nav__link for=__nav_3_4_4 id=__nav_3_4_4_label tabindex=0> <span class=md-ellipsis> AWS Integration </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_4_4_label aria-expanded=false> <label class=md-nav__title for=__nav_3_4_4> <span class="md-nav__icon md-icon"></span> AWS Integration </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../waf-tf-configuration/ class=md-nav__link> <span class=md-ellipsis> Configure AWS WAF With Terraform </span> </a> </li> <li class=md-nav__item> <a href=../ebs-csi-driver/ class=md-nav__link> <span class=md-ellipsis> Install Amazon EBS CSI Driver </span> </a> </li> <li class=md-nav__item> <a href=../enable-irsa/ class=md-nav__link> <span class=md-ellipsis> Associate IAM Roles With Service Accounts </span> </a> </li> <li class=md-nav__item> <a href=../kaniko-irsa/ class=md-nav__link> <span class=md-ellipsis> IAM Roles for Kaniko Service Accounts </span> </a> </li> <li class=md-nav__item> <a href=../velero-irsa/ class=md-nav__link> <span class=md-ellipsis> IAM Roles for Velero Service Accounts </span> </a> </li> <li class=md-nav__item> <a href=../loki-irsa/ class=md-nav__link> <span class=md-ellipsis> IAM Roles for Loki Service Accounts </span> </a> </li> <li class=md-nav__item> <a href=../configure-keycloak-oidc-eks/ class=md-nav__link> <span class=md-ellipsis> EKS OIDC With Keycloak </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_4_5> <label class=md-nav__link for=__nav_3_4_5 id=__nav_3_4_5_label tabindex=0> <span class=md-ellipsis> ReportPortal </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_4_5_label aria-expanded=false> <label class=md-nav__title for=__nav_3_4_5> <span class="md-nav__icon md-icon"></span> ReportPortal </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../reportportal-keycloak/ class=md-nav__link> <span class=md-ellipsis> Keycloak Integration </span> </a> </li> <li class=md-nav__item> <a href=../report-portal-integration-tekton/ class=md-nav__link> <span class=md-ellipsis> Integration With Tekton </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../logsight-integration/ class=md-nav__link> <span class=md-ellipsis> Logsight Integration </span> </a> </li> <li class=md-nav__item> <a href=../dependency-track/ class=md-nav__link> <span class=md-ellipsis> DependencyTrack </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_4_8> <label class=md-nav__link for=__nav_3_4_8 id=__nav_3_4_8_label tabindex=0> <span class=md-ellipsis> SonarQube </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_4_8_label aria-expanded=false> <label class=md-nav__title for=__nav_3_4_8> <span class="md-nav__icon md-icon"></span> SonarQube </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../sonarqube/ class=md-nav__link> <span class=md-ellipsis> SonarQube Integration </span> </a> </li> <li class=md-nav__item> <a href=../sonarqube-visibility/ class=md-nav__link> <span class=md-ellipsis> SonarQube Project Visibility </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../nexus-sonatype/ class=md-nav__link> <span class=md-ellipsis> Nexus Sonatype </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_5> <label class=md-nav__link for=__nav_3_5 id=__nav_3_5_label tabindex> <span class=md-ellipsis> Platform Capabilities </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_5_label aria-expanded=false> <label class=md-nav__title for=__nav_3_5> <span class="md-nav__icon md-icon"></span> Platform Capabilities </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_5_1> <label class=md-nav__link for=__nav_3_5_1 id=__nav_3_5_1_label tabindex=0> <span class=md-ellipsis> GitOps </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_5_1_label aria-expanded=false> <label class=md-nav__title for=__nav_3_5_1> <span class="md-nav__icon md-icon"></span> GitOps </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../argocd-integration/ class=md-nav__link> <span class=md-ellipsis> Argo CD Integration </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_5_2> <label class=md-nav__link for=__nav_3_5_2 id=__nav_3_5_2_label tabindex=0> <span class=md-ellipsis> Secrets Management </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_5_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_5_2> <span class="md-nav__icon md-icon"></span> Secrets Management </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../install-external-secrets-operator/ class=md-nav__link> <span class=md-ellipsis> Install External Secrets Operator </span> </a> </li> <li class=md-nav__item> <a href=../external-secrets-operator-integration/ class=md-nav__link> <span class=md-ellipsis> External Secrets Operator Integration </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_5_3> <label class=md-nav__link for=__nav_3_5_3 id=__nav_3_5_3_label tabindex=0> <span class=md-ellipsis> DevSecOps </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_5_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3_5_3> <span class="md-nav__icon md-icon"></span> DevSecOps </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../overview-devsecops/ class=md-nav__link> <span class=md-ellipsis> Secure Delivery </span> </a> </li> <li class=md-nav__item> <a href=../artifacts-verification/ class=md-nav__link> <span class=md-ellipsis> Verification of EDP Artifacts </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_5_4> <label class=md-nav__link for=__nav_3_5_4 id=__nav_3_5_4_label tabindex=0> <span class=md-ellipsis> Backup With Velero </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_5_4_label aria-expanded=false> <label class=md-nav__title for=__nav_3_5_4> <span class="md-nav__icon md-icon"></span> Backup With Velero </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../install-velero/ class=md-nav__link> <span class=md-ellipsis> Install Velero </span> </a> </li> <li class=md-nav__item> <a href=../restore-edp-with-velero/ class=md-nav__link> <span class=md-ellipsis> Restore EDP Tenant With Velero </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_5_5> <label class=md-nav__link for=__nav_3_5_5 id=__nav_3_5_5_label tabindex=0> <span class=md-ellipsis> Logging </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_5_5_label aria-expanded=false> <label class=md-nav__title for=__nav_3_5_5> <span class="md-nav__icon md-icon"></span> Logging </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../install-loki/ class=md-nav__link> <span class=md-ellipsis> Install Grafana Loki </span> </a> </li> <li class=md-nav__item> <a href=../multitenant-logging/ class=md-nav__link> <span class=md-ellipsis> Multitenant Logging </span> </a> </li> <li class=md-nav__item> <a href=../schedule-pods-restart/ class=md-nav__link> <span class=md-ellipsis> Schedule Pods Restart </span> </a> </li> <li class=md-nav__item> <a href=../kibana-ilm-rollover/ class=md-nav__link> <span class=md-ellipsis> Aggregate Application Logs Using EFK Stack </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../manage-custom-certificate/ class=md-nav__link> <span class=md-ellipsis> Manage Custom Certificates </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_5_7> <label class=md-nav__link for=__nav_3_5_7 id=__nav_3_5_7_label tabindex=0> <span class=md-ellipsis> Single Sign-on </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_5_7_label aria-expanded=false> <label class=md-nav__title for=__nav_3_5_7> <span class="md-nav__icon md-icon"></span> Single Sign-on </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../oauth2-proxy/ class=md-nav__link> <span class=md-ellipsis> Protect Endpoints </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_6 checked> <label class=md-nav__link for=__nav_3_6 id=__nav_3_6_label tabindex> <span class=md-ellipsis> Upgrade </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_6_label aria-expanded=true> <label class=md-nav__title for=__nav_3_6> <span class="md-nav__icon md-icon"></span> Upgrade </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_6_1> <label class=md-nav__link for=__nav_3_6_1 id=__nav_3_6_1_label tabindex=0> <span class=md-ellipsis> EDP </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_6_1_label aria-expanded=false> <label class=md-nav__title for=__nav_3_6_1> <span class="md-nav__icon md-icon"></span> EDP </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../upgrade-edp-3.9/ class=md-nav__link> <span class=md-ellipsis> v3.8 to 3.9 </span> </a> </li> <li class=md-nav__item> <a href=../upgrade-edp-3.8/ class=md-nav__link> <span class=md-ellipsis> v3.7 to 3.8 </span> </a> </li> <li class=md-nav__item> <a href=../upgrade-edp-3.7/ class=md-nav__link> <span class=md-ellipsis> v3.6 to 3.7 </span> </a> </li> <li class=md-nav__item> <a href=../upgrade-edp-3.6/ class=md-nav__link> <span class=md-ellipsis> v3.5 to 3.6 </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_6_1_5> <label class=md-nav__link for=__nav_3_6_1_5 id=__nav_3_6_1_5_label tabindex=0> <span class=md-ellipsis> Older Versions </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_3_6_1_5_label aria-expanded=false> <label class=md-nav__title for=__nav_3_6_1_5> <span class="md-nav__icon md-icon"></span> Older Versions </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../upgrade-edp-3.5/ class=md-nav__link> <span class=md-ellipsis> v3.4 to 3.5 </span> </a> </li> <li class=md-nav__item> <a href=../upgrade-edp-3.4/ class=md-nav__link> <span class=md-ellipsis> v3.3 to 3.4 </span> </a> </li> <li class=md-nav__item> <a href=../upgrade-edp-3.3/ class=md-nav__link> <span class=md-ellipsis> v3.2 to 3.3 </span> </a> </li> <li class=md-nav__item> <a href=../upgrade-edp-3.2/ class=md-nav__link> <span class=md-ellipsis> v3.1 to 3.2 </span> </a> </li> <li class=md-nav__item> <a href=../upgrade-edp-3.1/ class=md-nav__link> <span class=md-ellipsis> v3.0 to 3.1 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_6_2 checked> <label class=md-nav__link for=__nav_3_6_2 id=__nav_3_6_2_label tabindex=0> <span class=md-ellipsis> Keycloak </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_6_2_label aria-expanded=true> <label class=md-nav__title for=__nav_3_6_2> <span class="md-nav__icon md-icon"></span> Keycloak </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> v17.0 to 19.0 </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> v17.0 to 19.0 </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#prerequisites class=md-nav__link> <span class=md-ellipsis> Prerequisites </span> </a> </li> <li class=md-nav__item> <a href=#upgrade-postgres-database-to-a-minor-release-v1117 class=md-nav__link> <span class=md-ellipsis> Upgrade Postgres Database to a Minor Release v.11.17 </span> </a> <nav class=md-nav aria-label="Upgrade Postgres Database to a Minor Release v.11.17"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#delete-keycloak-resources class=md-nav__link> <span class=md-ellipsis> Delete Keycloak Resources </span> </a> </li> <li class=md-nav__item> <a href=#upgrade-keycloak class=md-nav__link> <span class=md-ellipsis> Upgrade Keycloak </span> </a> </li> <li class=md-nav__item> <a href=#install-postgres class=md-nav__link> <span class=md-ellipsis> Install Postgres </span> </a> </li> <li class=md-nav__item> <a href=#clean-and-analyze-database class=md-nav__link> <span class=md-ellipsis> Clean and Analyze Database </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#migrate-postgres-database-from-postgres-v11x-to-v145 class=md-nav__link> <span class=md-ellipsis> Migrate Postgres Database From Postgres v.11.x to v.14.5 </span> </a> <nav class=md-nav aria-label="Migrate Postgres Database From Postgres v.11.x to v.14.5"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#export-postgres-databases class=md-nav__link> <span class=md-ellipsis> Export Postgres Databases </span> </a> </li> <li class=md-nav__item> <a href=#delete-keycloak-resources_1 class=md-nav__link> <span class=md-ellipsis> Delete Keycloak Resources </span> </a> </li> <li class=md-nav__item> <a href=#install-postgres_1 class=md-nav__link> <span class=md-ellipsis> Install Postgres </span> </a> </li> <li class=md-nav__item> <a href=#import-postgres-databases class=md-nav__link> <span class=md-ellipsis> Import Postgres Databases </span> </a> </li> <li class=md-nav__item> <a href=#install-keycloak class=md-nav__link> <span class=md-ellipsis> Install Keycloak </span> </a> </li> <li class=md-nav__item> <a href=#clean-and-analyze-database_1 class=md-nav__link> <span class=md-ellipsis> Clean and Analyze Database </span> </a> </li> <li class=md-nav__item> <a href=#postgres-database-migration-script class=md-nav__link> <span class=md-ellipsis> Postgres Database Migration Script </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#related-articles class=md-nav__link> <span class=md-ellipsis> Related Articles </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_7> <label class=md-nav__link for=__nav_3_7 id=__nav_3_7_label tabindex> <span class=md-ellipsis> Tutorials </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_7_label aria-expanded=false> <label class=md-nav__title for=__nav_3_7> <span class="md-nav__icon md-icon"></span> Tutorials </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../user-guide/terraform-stages/ class=md-nav__link> <span class=md-ellipsis> CI Pipelines for Terraform </span> </a> </li> <li class=md-nav__item> <a href=../deploy-aws-eks/ class=md-nav__link> <span class=md-ellipsis> Deploy AWS EKS Cluster </span> </a> </li> <li class=md-nav__item> <a href=../deploy-okd/ class=md-nav__link> <span class=md-ellipsis> Deploy OKD 4.9 Cluster </span> </a> </li> <li class=md-nav__item> <a href=../deploy-okd-4.10/ class=md-nav__link> <span class=md-ellipsis> Deploy OKD 4.10 Cluster </span> </a> </li> <li class=md-nav__item> <a href=../ssl-automation-okd/ class=md-nav__link> <span class=md-ellipsis> Use Cert-Manager in OpenShift </span> </a> </li> <li class=md-nav__item> <a href=../migrate-ci-pipelines-from-jenkins-to-tekton/ class=md-nav__link> <span class=md-ellipsis> Migrate CI Pipelines From Jenkins to Tekton </span> </a> </li> <li class=md-nav__item> <a href=../delete-edp/ class=md-nav__link> <span class=md-ellipsis> Uninstall EDP </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../faq/ class=md-nav__link> <span class=md-ellipsis> FAQ </span> </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_9> <label class=md-nav__link for=__nav_3_9 id=__nav_3_9_label tabindex> <span class=md-ellipsis> Troubleshooting </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_9_label aria-expanded=false> <label class=md-nav__title for=__nav_3_9> <span class="md-nav__icon md-icon"></span> Troubleshooting </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../troubleshooting/overview/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../troubleshooting/troubleshoot-container-registries/ class=md-nav__link> <span class=md-ellipsis> Container Registry Reset </span> </a> </li> <li class=md-nav__item> <a href=../troubleshooting/troubleshoot-stages/ class=md-nav__link> <span class=md-ellipsis> Application Is Not Deployed </span> </a> </li> <li class=md-nav__item> <a href=../troubleshooting/troubleshoot-git-server/ class=md-nav__link> <span class=md-ellipsis> Codebase Creation Issue </span> </a> </li> <li class=md-nav__item> <a href=../troubleshooting/resource-observability/ class=md-nav__link> <span class=md-ellipsis> Resource Observability Issue </span> </a> </li> <li class=md-nav__item> <a href=../troubleshooting/troubleshoot-applications/ class=md-nav__link> <span class=md-ellipsis> Application Already Exists Error (Gerrit VCS) </span> </a> </li> <li class=md-nav__item> <a href=../troubleshooting/application-not-built/ class=md-nav__link> <span class=md-ellipsis> Codebase Build Process is Failed </span> </a> </li> <li class=md-nav__item> <a href=../troubleshooting/invalid-codebase-name/ class=md-nav__link> <span class=md-ellipsis> Invalid Codebase ID Issue (GitHub/GitLab VCS) </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex> <span class=md-ellipsis> User Guide </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> User Guide </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../user-guide/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_2> <label class=md-nav__link for=__nav_4_2 id=__nav_4_2_label tabindex> <span class=md-ellipsis> Marketplace </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_2_label aria-expanded=false> <label class=md-nav__title for=__nav_4_2> <span class="md-nav__icon md-icon"></span> Marketplace </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../user-guide/marketplace/ class=md-nav__link> <span class=md-ellipsis> Marketplace Overview </span> </a> </li> <li class=md-nav__item> <a href=../../user-guide/add-marketplace/ class=md-nav__link> <span class=md-ellipsis> Add Component via Marketplace </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_3> <label class=md-nav__link for=__nav_4_3 id=__nav_4_3_label tabindex> <span class=md-ellipsis> Components </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_3_label aria-expanded=false> <label class=md-nav__title for=__nav_4_3> <span class="md-nav__icon md-icon"></span> Components </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../user-guide/components/ class=md-nav__link> <span class=md-ellipsis> Components Overview </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_3_2> <label class=md-nav__link for=__nav_4_3_2 id=__nav_4_3_2_label tabindex=0> <span class=md-ellipsis> Application </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_4_3_2_label aria-expanded=false> <label class=md-nav__title for=__nav_4_3_2> <span class="md-nav__icon md-icon"></span> Application </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../user-guide/add-application/ class=md-nav__link> <span class=md-ellipsis> Add Application </span> </a> </li> <li class=md-nav__item> <a href=../../user-guide/application/ class=md-nav__link> <span class=md-ellipsis> Manage Applications </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_3_3> <label class=md-nav__link for=__nav_4_3_3 id=__nav_4_3_3_label tabindex=0> <span class=md-ellipsis> Autotest </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_4_3_3_label aria-expanded=false> <label class=md-nav__title for=__nav_4_3_3> <span class="md-nav__icon md-icon"></span> Autotest </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../user-guide/add-autotest/ class=md-nav__link> <span class=md-ellipsis> Add Autotest </span> </a> </li> <li class=md-nav__item> <a href=../../user-guide/autotest/ class=md-nav__link> <span class=md-ellipsis> Manage Autotests </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_3_4> <label class=md-nav__link for=__nav_4_3_4 id=__nav_4_3_4_label tabindex=0> <span class=md-ellipsis> Library </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_4_3_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4_3_4> <span class="md-nav__icon md-icon"></span> Library </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../user-guide/add-library/ class=md-nav__link> <span class=md-ellipsis> Add Library </span> </a> </li> <li class=md-nav__item> <a href=../../user-guide/library/ class=md-nav__link> <span class=md-ellipsis> Manage Libraries </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_3_5> <label class=md-nav__link for=__nav_4_3_5 id=__nav_4_3_5_label tabindex=0> <span class=md-ellipsis> Infrastructure </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_4_3_5_label aria-expanded=false> <label class=md-nav__title for=__nav_4_3_5> <span class="md-nav__icon md-icon"></span> Infrastructure </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../user-guide/add-infrastructure/ class=md-nav__link> <span class=md-ellipsis> Add Infrastructure </span> </a> </li> <li class=md-nav__item> <a href=../../user-guide/infrastructure/ class=md-nav__link> <span class=md-ellipsis> Manage Infrastructures </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../user-guide/manage-branches/ class=md-nav__link> <span class=md-ellipsis> Manage Branches </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_4> <label class=md-nav__link for=__nav_4_4 id=__nav_4_4_label tabindex> <span class=md-ellipsis> Environments </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4_4> <span class="md-nav__icon md-icon"></span> Environments </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../user-guide/add-cd-pipeline/ class=md-nav__link> <span class=md-ellipsis> Add Environment </span> </a> </li> <li class=md-nav__item> <a href=../../user-guide/manage-environments/ class=md-nav__link> <span class=md-ellipsis> Manage Environments </span> </a> </li> <li class=md-nav__item> <a href=../../user-guide/add-quality-gate/ class=md-nav__link> <span class=md-ellipsis> Add Quality Gate </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_5> <label class=md-nav__link for=__nav_4_5 id=__nav_4_5_label tabindex> <span class=md-ellipsis> Configuration </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_5_label aria-expanded=false> <label class=md-nav__title for=__nav_4_5> <span class="md-nav__icon md-icon"></span> Configuration </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../user-guide/configuration-overview/ class=md-nav__link> <span class=md-ellipsis> Configuration Overview </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_5_2> <label class=md-nav__link for=__nav_4_5_2 id=__nav_4_5_2_label tabindex=0> <span class=md-ellipsis> Links </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_4_5_2_label aria-expanded=false> <label class=md-nav__title for=__nav_4_5_2> <span class="md-nav__icon md-icon"></span> Links </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../user-guide/quick-links/ class=md-nav__link> <span class=md-ellipsis> Manage Quick Links </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_5_3> <label class=md-nav__link for=__nav_4_5_3 id=__nav_4_5_3_label tabindex=0> <span class=md-ellipsis> Git Server </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_4_5_3_label aria-expanded=false> <label class=md-nav__title for=__nav_4_5_3> <span class="md-nav__icon md-icon"></span> Git Server </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../user-guide/git-server-overview/ class=md-nav__link> <span class=md-ellipsis> Manage Git Servers </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_5_4> <label class=md-nav__link for=__nav_4_5_4 id=__nav_4_5_4_label tabindex=0> <span class=md-ellipsis> Cluster </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_4_5_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4_5_4> <span class="md-nav__icon md-icon"></span> Cluster </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../user-guide/add-cluster/ class=md-nav__link> <span class=md-ellipsis> Add Cluster </span> </a> </li> <li class=md-nav__item> <a href=../../user-guide/cluster/ class=md-nav__link> <span class=md-ellipsis> Manage Clusters </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_5_5> <label class=md-nav__link for=__nav_4_5_5 id=__nav_4_5_5_label tabindex=0> <span class=md-ellipsis> GitOps </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_4_5_5_label aria-expanded=false> <label class=md-nav__title for=__nav_4_5_5> <span class="md-nav__icon md-icon"></span> GitOps </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../user-guide/gitops/ class=md-nav__link> <span class=md-ellipsis> Manage GitOps </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_5_6> <label class=md-nav__link for=__nav_4_5_6 id=__nav_4_5_6_label tabindex=0> <span class=md-ellipsis> Container Registry </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_4_5_6_label aria-expanded=false> <label class=md-nav__title for=__nav_4_5_6> <span class="md-nav__icon md-icon"></span> Container Registry </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../user-guide/manage-container-registries/ class=md-nav__link> <span class=md-ellipsis> Manage Registries </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex> <span class=md-ellipsis> Developer Guide </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Developer Guide </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../developer-guide/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../../developer-guide/reference-architecture/ class=md-nav__link> <span class=md-ellipsis> Reference Architecture </span> </a> </li> <li class=md-nav__item> <a href=../../developer-guide/kubernetes-deployment/ class=md-nav__link> <span class=md-ellipsis> Kubernetes Deployment </span> </a> </li> <li class=md-nav__item> <a href=../../developer-guide/reference-cicd-pipeline/ class=md-nav__link> <span class=md-ellipsis> Reference CI/CD Pipeline </span> </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_5> <label class=md-nav__link for=__nav_5_5 id=__nav_5_5_label tabindex> <span class=md-ellipsis> Cloud Providers </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5_5> <span class="md-nav__icon md-icon"></span> Cloud Providers </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_5_1> <label class=md-nav__link for=__nav_5_5_1 id=__nav_5_5_1_label tabindex=0> <span class=md-ellipsis> AWS </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_5_5_1_label aria-expanded=false> <label class=md-nav__title for=__nav_5_5_1> <span class="md-nav__icon md-icon"></span> AWS </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../developer-guide/aws-reference-architecture/ class=md-nav__link> <span class=md-ellipsis> EDP Reference Architecture on AWS </span> </a> </li> <li class=md-nav__item> <a href=../../developer-guide/aws-deployment-diagram/ class=md-nav__link> <span class=md-ellipsis> EDP Deployment on AWS </span> </a> </li> <li class=md-nav__item> <a href=../../developer-guide/aws-infrastructure-cost-estimation/ class=md-nav__link> <span class=md-ellipsis> AWS Infrastructure Cost Estimation </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_6> <label class=md-nav__link for=__nav_5_6 id=__nav_5_6_label tabindex> <span class=md-ellipsis> Development </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_6_label aria-expanded=false> <label class=md-nav__title for=__nav_5_6> <span class="md-nav__icon md-icon"></span> Development </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../developer-guide/edp-workflow/ class=md-nav__link> <span class=md-ellipsis> KubeRocketCI Project Rules. Working Process </span> </a> </li> <li class=md-nav__item> <a href=../../developer-guide/local-development/ class=md-nav__link> <span class=md-ellipsis> Operator Development </span> </a> </li> <li class=md-nav__item> <a href=../../developer-guide/mk-docs-development/ class=md-nav__link> <span class=md-ellipsis> Working With Documentation </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../developer-guide/autotest-coverage/ class=md-nav__link> <span class=md-ellipsis> Quality Control </span> </a> </li> <li class=md-nav__item> <a href=../../developer-guide/telemetry/ class=md-nav__link> <span class=md-ellipsis> Telemetry </span> </a> </li> <li class=md-nav__item> <a href=../../developer-guide/annotations-and-labels/ class=md-nav__link> <span class=md-ellipsis> Annotations and Labels </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex> <span class=md-ellipsis> Use Cases </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Use Cases </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../use-cases/ class=md-nav__link> <span class=md-ellipsis> Use Cases </span> </a> </li> <li class=md-nav__item> <a href=../../use-cases/application-scaffolding/ class=md-nav__link> <span class=md-ellipsis> Scaffold and Deploy FastAPI Application </span> </a> </li> <li class=md-nav__item> <a href=../../use-cases/tekton-custom-pipelines/ class=md-nav__link> <span class=md-ellipsis> Deploy Application With Custom Build Tool/Framework </span> </a> </li> <li class=md-nav__item> <a href=../../use-cases/external-secrets/ class=md-nav__link> <span class=md-ellipsis> Secured Secrets Management for Application Deployment </span> </a> </li> <li class=md-nav__item> <a href=../../use-cases/autotest-as-quality-gate/ class=md-nav__link> <span class=md-ellipsis> Autotest as a Quality Gate </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../pricing/ class=md-nav__link> <span class=md-ellipsis> Pricing </span> </a> </li> <li class=md-nav__item> <a href=../../roadmap/ class=md-nav__link> <span class=md-ellipsis> RoadMap </span> </a> </li> <li class=md-nav__item> <a href=https://github.com/epam/edp-install/blob/master/RELEASES.md class=md-nav__link> <span class=md-ellipsis> Releases â§‰ </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#prerequisites class=md-nav__link> <span class=md-ellipsis> Prerequisites </span> </a> </li> <li class=md-nav__item> <a href=#upgrade-postgres-database-to-a-minor-release-v1117 class=md-nav__link> <span class=md-ellipsis> Upgrade Postgres Database to a Minor Release v.11.17 </span> </a> <nav class=md-nav aria-label="Upgrade Postgres Database to a Minor Release v.11.17"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#delete-keycloak-resources class=md-nav__link> <span class=md-ellipsis> Delete Keycloak Resources </span> </a> </li> <li class=md-nav__item> <a href=#upgrade-keycloak class=md-nav__link> <span class=md-ellipsis> Upgrade Keycloak </span> </a> </li> <li class=md-nav__item> <a href=#install-postgres class=md-nav__link> <span class=md-ellipsis> Install Postgres </span> </a> </li> <li class=md-nav__item> <a href=#clean-and-analyze-database class=md-nav__link> <span class=md-ellipsis> Clean and Analyze Database </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#migrate-postgres-database-from-postgres-v11x-to-v145 class=md-nav__link> <span class=md-ellipsis> Migrate Postgres Database From Postgres v.11.x to v.14.5 </span> </a> <nav class=md-nav aria-label="Migrate Postgres Database From Postgres v.11.x to v.14.5"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#export-postgres-databases class=md-nav__link> <span class=md-ellipsis> Export Postgres Databases </span> </a> </li> <li class=md-nav__item> <a href=#delete-keycloak-resources_1 class=md-nav__link> <span class=md-ellipsis> Delete Keycloak Resources </span> </a> </li> <li class=md-nav__item> <a href=#install-postgres_1 class=md-nav__link> <span class=md-ellipsis> Install Postgres </span> </a> </li> <li class=md-nav__item> <a href=#import-postgres-databases class=md-nav__link> <span class=md-ellipsis> Import Postgres Databases </span> </a> </li> <li class=md-nav__item> <a href=#install-keycloak class=md-nav__link> <span class=md-ellipsis> Install Keycloak </span> </a> </li> <li class=md-nav__item> <a href=#clean-and-analyze-database_1 class=md-nav__link> <span class=md-ellipsis> Clean and Analyze Database </span> </a> </li> <li class=md-nav__item> <a href=#postgres-database-migration-script class=md-nav__link> <span class=md-ellipsis> Postgres Database Migration Script </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#related-articles class=md-nav__link> <span class=md-ellipsis> Related Articles </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <div><h1 id=upgrade-keycloak-v170-to-190>Upgrade Keycloak v17.0 to 19.0<a class=headerlink href=#upgrade-keycloak-v170-to-190 title="Permanent link">âš“ï¸Ž</a></h1> <p>Starting from Keycloak v.18.x.x, the Keycloak server has been moved from the Wildfly (JBoss) Application Server to <a href=https://quarkus.io/ >Quarkus</a> framework and is called Keycloak.X.</p> <p>There are two ways to upgrade Keycloak v.17.0.x-legacy to v.19.0.x on Kubernetes, please perform the steps described in the <a href=#Prrqsts>Prerequisites</a> section of this tutorial, and then select a suitable upgrade strategy for your environment:</p> <ul> <li><a href=#KPU>Upgrade Postgres database to a minor release v.11.17</a></li> <li><a href=#KPM>Migrate Postgres database from Postgres v.11.x to v.14.5</a></li> </ul> <h2 id=prerequisites>Prerequisites <a name=Prrqsts></a><a class=headerlink href=#prerequisites title="Permanent link">âš“ï¸Ž</a></h2> <p>Before upgrading Keycloak, please perform the steps below:</p> <ol> <li> <p>Create a backup/snapshot of the Keycloak database volume. Locate the AWS <code>volumeID</code> and then create its <a href=https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ebs-creating-snapshot.html>snapshot</a> on AWS:</p> <ul> <li> <p>Find the <code>PVC</code> name attached to the Postgres pod. It can be similar to <code>data-keycloak-postgresql-0</code> if the Postgres <code>StatefulSet</code> name is <code>keycloak-postgresql</code>:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a>kubectl<span class=w> </span>get<span class=w> </span>pods<span class=w> </span>keycloak-postgresql-0<span class=w> </span>-n<span class=w> </span>security<span class=w> </span>-o<span class=w> </span><span class=nv>jsonpath</span><span class=o>=</span><span class=s1>'{.spec.volumes[*].persistentVolumeClaim.claimName}{"\n"}'</span>
</span></code></pre></div> </li> </ul> <ul> <li> <p>Locate the <code>PV</code> <code>volumeName</code> in the <code>data-keycloak-postgresql-0</code> Persistent Volume Claim:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a>kubectl<span class=w> </span>get<span class=w> </span>pvc<span class=w> </span>data-keycloak-postgresql-0<span class=w> </span>-n<span class=w> </span>security<span class=w> </span>-o<span class=w> </span><span class=nv>jsonpath</span><span class=o>=</span><span class=s1>'{.spec.volumeName}{"\n"}'</span>
</span></code></pre></div> </li> </ul> <ul> <li> <p>Get <code>volumeID</code> in the Persistent Volume:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a>kubectl<span class=w> </span>get<span class=w> </span>pv<span class=w> </span><span class=si>${</span><span class=nv>pv_name</span><span class=si>}</span><span class=w> </span>-n<span class=w> </span>security<span class=w> </span>-o<span class=w> </span><span class=nv>jsonpath</span><span class=o>=</span><span class=s1>'{.spec.awsElasticBlockStore.volumeID}{"\n"}'</span>
</span></code></pre></div> </li> </ul> </li> <li> <p>Add two additional keys: <code>password</code> and <code>postgres-password</code>, to the <code>keycloak-postgresql</code> secret in the Keycloak namespace.</p> <div class="admonition note"> <p class=admonition-title>Note</p> <ul> <li>The <code>password</code> key must have the same value as the <code>postgresql-password</code> key.</li> <li>The <code>postgres-password</code> key must have the same value as the <code>postgresql-postgres-password</code> key.</li> </ul> </div> <p>The latest chart for Keycloak.X does not have an option to override Postgres password and admin password keys in the secret, and it uses the Postgres <a href=https://github.com/codecentric/helm-charts/blob/master/charts/keycloakx/values.yaml#L371>defaults</a>, therefore, a new secret scheme must be implemented:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a>kubectl<span class=w> </span>-n<span class=w> </span>security<span class=w> </span>edit<span class=w> </span>secret<span class=w> </span>keycloak-postgresql
</span></code></pre></div> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=nt>data</span><span class=p>:</span>
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=w>  </span><span class=nt>postgresql-password</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">XXXXXX</span>
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a><span class=w>  </span><span class=nt>postgresql-postgres-password</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">YYYYYY</span>
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a><span class=w>  </span><span class=nt>password</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">XXXXXX</span>
</span><span id=__span-4-5><a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a><span class=w>  </span><span class=nt>postgres-password</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">YYYYYY</span>
</span></code></pre></div> </li> <li> <p>Save Keycloak <code>StatefulSet</code> names, for example, <code>keycloak</code> and <code>keycloak-postgresql</code>. These names will be used in the new Helm deployments:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a>$<span class=w> </span>kubectl<span class=w> </span>get<span class=w> </span>statefulset<span class=w> </span>-n<span class=w> </span>security
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a>NAME<span class=w>                  </span>READY<span class=w>   </span>AGE
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a>keycloak<span class=w>              </span><span class=m>1</span>/1<span class=w>     </span>18h
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a>keycloak-postgresql<span class=w>   </span><span class=m>1</span>/1<span class=w>     </span>18h
</span></code></pre></div> </li> </ol> <h2 id=upgrade-postgres-database-to-a-minor-release-v1117>Upgrade Postgres Database to a Minor Release v.11.17 <a name=KPU></a><a class=headerlink href=#upgrade-postgres-database-to-a-minor-release-v1117 title="Permanent link">âš“ï¸Ž</a></h2> <p>To upgrade Keycloak by upgrading <a href=https://www.postgresql.org/ >Postgres Database</a> to a minor release v.11.17, perform the steps described in the <a href=#Prrqsts>Prerequisites</a> section of this tutorial, and then perform the following steps:</p> <h3 id=delete-keycloak-resources>Delete Keycloak Resources<a class=headerlink href=#delete-keycloak-resources title="Permanent link">âš“ï¸Ž</a></h3> <ol> <li> <p>Delete <code>Keycloak</code> and <code>Prostgres</code> <code>StatefulSets</code>:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a>kubectl<span class=w> </span>delete<span class=w> </span>statefulset<span class=w> </span>keycloak<span class=w> </span>keycloak-postgresql<span class=w> </span>-n<span class=w> </span>security
</span></code></pre></div> </li> <li> <p>Delete the Keycloak <code>Ingress</code>object, to prevent hostname duplication issues:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a>kubectl<span class=w> </span>delete<span class=w> </span>ingress<span class=w> </span>keycloak<span class=w> </span>-n<span class=w> </span>security
</span></code></pre></div> </li> </ol> <h3 id=upgrade-keycloak>Upgrade Keycloak<a class=headerlink href=#upgrade-keycloak title="Permanent link">âš“ï¸Ž</a></h3> <ol> <li> <p>Make sure the Keycloak chart repository is added:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a>helm<span class=w> </span>repo<span class=w> </span>add<span class=w> </span>codecentric<span class=w> </span>https://codecentric.github.io/helm-charts
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a>helm<span class=w> </span>repo<span class=w> </span>update
</span></code></pre></div> </li> <li> <p>Create values for Keycloak:</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Since the Keycloak.X release, Keycloak and Postgres database charts are separated. Upgrade Keycloak, and then install the Postgres database.</p> </div> <div class="admonition note"> <p class=admonition-title>Note</p> <ul> <li><code>nameOverride: "keycloak"</code> sets the name of the Keycloak pod. It must be the same Keycloak name as in the previous <code>StatefulSet</code>.</li> <li>Change Ingress host name to the Keycloak host name.</li> <li><code>hostname: keycloak-postgresql</code> is the hostname of the pod with the Postgres database that is the same as Postgres StatefulSet name, for example, <code>keycloak-postgresql</code>.</li> <li><code>"/opt/keycloak/bin/kc.sh start --auto-build"</code> was used in the legacy Keycloak version. However, it is no longer required in the new Keycloak version since it is <a href=https://www.keycloak.org/docs/latest/upgrading/index.html#changes-to-the-server-configuration-and-startup>deprecated</a> and used by default.</li> <li> <p>Optionally, use the following command for applying the old Keycloak theme:</p> <p></p><div class="language-bash highlight"><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a>bin/kc.sh<span class=w> </span>start<span class=w> </span>--features-disabled<span class=o>=</span>admin2
</span></code></pre></div> </li> </ul> </div> <details> <summary><b>View: keycloak-values.yaml</b></summary> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=nt>nameOverride</span><span class=p>:</span><span class=w> </span><span class=s>"keycloak"</span>
</span><span id=__span-10-2><a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a>
</span><span id=__span-10-3><a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
</span><span id=__span-10-4><a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a>
</span><span id=__span-10-5><a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a><span class=c1># Deploy the latest verion</span>
</span><span id=__span-10-6><a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a><span class=nt>image</span><span class=p>:</span>
</span><span id=__span-10-7><a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a><span class=w>  </span><span class=nt>tag</span><span class=p>:</span><span class=w> </span><span class=s>"19.0.1"</span>
</span><span id=__span-10-8><a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a>
</span><span id=__span-10-9><a id=__codelineno-10-9 name=__codelineno-10-9 href=#__codelineno-10-9></a><span class=c1># start: create OpenShift realm which is required by EDP</span>
</span><span id=__span-10-10><a id=__codelineno-10-10 name=__codelineno-10-10 href=#__codelineno-10-10></a><span class=nt>extraInitContainers</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
</span><span id=__span-10-11><a id=__codelineno-10-11 name=__codelineno-10-11 href=#__codelineno-10-11></a><span class=w>  </span><span class=no>- name: realm-provider</span>
</span><span id=__span-10-12><a id=__codelineno-10-12 name=__codelineno-10-12 href=#__codelineno-10-12></a><span class=w>    </span><span class=no>image: busybox</span>
</span><span id=__span-10-13><a id=__codelineno-10-13 name=__codelineno-10-13 href=#__codelineno-10-13></a><span class=w>    </span><span class=no>imagePullPolicy: IfNotPresent</span>
</span><span id=__span-10-14><a id=__codelineno-10-14 name=__codelineno-10-14 href=#__codelineno-10-14></a><span class=w>    </span><span class=no>command:</span>
</span><span id=__span-10-15><a id=__codelineno-10-15 name=__codelineno-10-15 href=#__codelineno-10-15></a><span class=w>      </span><span class=no>- sh</span>
</span><span id=__span-10-16><a id=__codelineno-10-16 name=__codelineno-10-16 href=#__codelineno-10-16></a><span class=w>    </span><span class=no>args:</span>
</span><span id=__span-10-17><a id=__codelineno-10-17 name=__codelineno-10-17 href=#__codelineno-10-17></a><span class=w>      </span><span class=no>- -c</span>
</span><span id=__span-10-18><a id=__codelineno-10-18 name=__codelineno-10-18 href=#__codelineno-10-18></a><span class=w>      </span><span class=no>- |</span>
</span><span id=__span-10-19><a id=__codelineno-10-19 name=__codelineno-10-19 href=#__codelineno-10-19></a><span class=w>        </span><span class=no>echo '{"realm": "openshift","enabled": true}' &gt; /opt/keycloak/data/import/openshift.json</span>
</span><span id=__span-10-20><a id=__codelineno-10-20 name=__codelineno-10-20 href=#__codelineno-10-20></a><span class=w>    </span><span class=no>volumeMounts:</span>
</span><span id=__span-10-21><a id=__codelineno-10-21 name=__codelineno-10-21 href=#__codelineno-10-21></a><span class=w>      </span><span class=no>- name: realm</span>
</span><span id=__span-10-22><a id=__codelineno-10-22 name=__codelineno-10-22 href=#__codelineno-10-22></a><span class=w>        </span><span class=no>mountPath: /opt/keycloak/data/import</span>
</span><span id=__span-10-23><a id=__codelineno-10-23 name=__codelineno-10-23 href=#__codelineno-10-23></a>
</span><span id=__span-10-24><a id=__codelineno-10-24 name=__codelineno-10-24 href=#__codelineno-10-24></a><span class=nt>extraVolumeMounts</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
</span><span id=__span-10-25><a id=__codelineno-10-25 name=__codelineno-10-25 href=#__codelineno-10-25></a><span class=w>  </span><span class=no>- name: realm</span>
</span><span id=__span-10-26><a id=__codelineno-10-26 name=__codelineno-10-26 href=#__codelineno-10-26></a><span class=w>    </span><span class=no>mountPath: /opt/keycloak/data/import</span>
</span><span id=__span-10-27><a id=__codelineno-10-27 name=__codelineno-10-27 href=#__codelineno-10-27></a>
</span><span id=__span-10-28><a id=__codelineno-10-28 name=__codelineno-10-28 href=#__codelineno-10-28></a><span class=nt>extraVolumes</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
</span><span id=__span-10-29><a id=__codelineno-10-29 name=__codelineno-10-29 href=#__codelineno-10-29></a><span class=w>  </span><span class=no>- name: realm</span>
</span><span id=__span-10-30><a id=__codelineno-10-30 name=__codelineno-10-30 href=#__codelineno-10-30></a><span class=w>    </span><span class=no>emptyDir: {}</span>
</span><span id=__span-10-31><a id=__codelineno-10-31 name=__codelineno-10-31 href=#__codelineno-10-31></a>
</span><span id=__span-10-32><a id=__codelineno-10-32 name=__codelineno-10-32 href=#__codelineno-10-32></a><span class=nt>command</span><span class=p>:</span>
</span><span id=__span-10-33><a id=__codelineno-10-33 name=__codelineno-10-33 href=#__codelineno-10-33></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>"/opt/keycloak/bin/kc.sh"</span>
</span><span id=__span-10-34><a id=__codelineno-10-34 name=__codelineno-10-34 href=#__codelineno-10-34></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>"--verbose"</span>
</span><span id=__span-10-35><a id=__codelineno-10-35 name=__codelineno-10-35 href=#__codelineno-10-35></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>"start"</span>
</span><span id=__span-10-36><a id=__codelineno-10-36 name=__codelineno-10-36 href=#__codelineno-10-36></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>"--http-enabled=true"</span>
</span><span id=__span-10-37><a id=__codelineno-10-37 name=__codelineno-10-37 href=#__codelineno-10-37></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>"--http-port=8080"</span>
</span><span id=__span-10-38><a id=__codelineno-10-38 name=__codelineno-10-38 href=#__codelineno-10-38></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>"--hostname-strict=false"</span>
</span><span id=__span-10-39><a id=__codelineno-10-39 name=__codelineno-10-39 href=#__codelineno-10-39></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>"--hostname-strict-https=false"</span>
</span><span id=__span-10-40><a id=__codelineno-10-40 name=__codelineno-10-40 href=#__codelineno-10-40></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>"--spi-events-listener-jboss-logging-success-level=info"</span>
</span><span id=__span-10-41><a id=__codelineno-10-41 name=__codelineno-10-41 href=#__codelineno-10-41></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>"--spi-events-listener-jboss-logging-error-level=warn"</span>
</span><span id=__span-10-42><a id=__codelineno-10-42 name=__codelineno-10-42 href=#__codelineno-10-42></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>"--import-realm"</span>
</span><span id=__span-10-43><a id=__codelineno-10-43 name=__codelineno-10-43 href=#__codelineno-10-43></a>
</span><span id=__span-10-44><a id=__codelineno-10-44 name=__codelineno-10-44 href=#__codelineno-10-44></a><span class=nt>extraEnv</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
</span><span id=__span-10-45><a id=__codelineno-10-45 name=__codelineno-10-45 href=#__codelineno-10-45></a><span class=w>  </span><span class=no>- name: KC_PROXY</span>
</span><span id=__span-10-46><a id=__codelineno-10-46 name=__codelineno-10-46 href=#__codelineno-10-46></a><span class=w>    </span><span class=no>value: "passthrough"</span>
</span><span id=__span-10-47><a id=__codelineno-10-47 name=__codelineno-10-47 href=#__codelineno-10-47></a><span class=w>  </span><span class=no>- name: KEYCLOAK_ADMIN</span>
</span><span id=__span-10-48><a id=__codelineno-10-48 name=__codelineno-10-48 href=#__codelineno-10-48></a><span class=w>    </span><span class=no>valueFrom:</span>
</span><span id=__span-10-49><a id=__codelineno-10-49 name=__codelineno-10-49 href=#__codelineno-10-49></a><span class=w>      </span><span class=no>secretKeyRef:</span>
</span><span id=__span-10-50><a id=__codelineno-10-50 name=__codelineno-10-50 href=#__codelineno-10-50></a><span class=w>        </span><span class=no>name: keycloak-admin-creds</span>
</span><span id=__span-10-51><a id=__codelineno-10-51 name=__codelineno-10-51 href=#__codelineno-10-51></a><span class=w>        </span><span class=no>key: username</span>
</span><span id=__span-10-52><a id=__codelineno-10-52 name=__codelineno-10-52 href=#__codelineno-10-52></a><span class=w>  </span><span class=no>- name: KEYCLOAK_ADMIN_PASSWORD</span>
</span><span id=__span-10-53><a id=__codelineno-10-53 name=__codelineno-10-53 href=#__codelineno-10-53></a><span class=w>    </span><span class=no>valueFrom:</span>
</span><span id=__span-10-54><a id=__codelineno-10-54 name=__codelineno-10-54 href=#__codelineno-10-54></a><span class=w>      </span><span class=no>secretKeyRef:</span>
</span><span id=__span-10-55><a id=__codelineno-10-55 name=__codelineno-10-55 href=#__codelineno-10-55></a><span class=w>        </span><span class=no>name: keycloak-admin-creds</span>
</span><span id=__span-10-56><a id=__codelineno-10-56 name=__codelineno-10-56 href=#__codelineno-10-56></a><span class=w>        </span><span class=no>key: password</span>
</span><span id=__span-10-57><a id=__codelineno-10-57 name=__codelineno-10-57 href=#__codelineno-10-57></a><span class=w>  </span><span class=no>- name: JAVA_OPTS_APPEND</span>
</span><span id=__span-10-58><a id=__codelineno-10-58 name=__codelineno-10-58 href=#__codelineno-10-58></a><span class=w>    </span><span class=no>value: &gt;-</span>
</span><span id=__span-10-59><a id=__codelineno-10-59 name=__codelineno-10-59 href=#__codelineno-10-59></a><span class=w>      </span><span class=no>-XX:+UseContainerSupport</span>
</span><span id=__span-10-60><a id=__codelineno-10-60 name=__codelineno-10-60 href=#__codelineno-10-60></a><span class=w>      </span><span class=no>-XX:MaxRAMPercentage=50.0</span>
</span><span id=__span-10-61><a id=__codelineno-10-61 name=__codelineno-10-61 href=#__codelineno-10-61></a><span class=w>      </span><span class=no>-Djava.awt.headless=true</span>
</span><span id=__span-10-62><a id=__codelineno-10-62 name=__codelineno-10-62 href=#__codelineno-10-62></a><span class=w>      </span><span class=no>-Djgroups.dns.query={{ include "keycloak.fullname" . }}-headless</span>
</span><span id=__span-10-63><a id=__codelineno-10-63 name=__codelineno-10-63 href=#__codelineno-10-63></a>
</span><span id=__span-10-64><a id=__codelineno-10-64 name=__codelineno-10-64 href=#__codelineno-10-64></a><span class=c1># This block should be uncommented if you install Keycloak on Kubernetes</span>
</span><span id=__span-10-65><a id=__codelineno-10-65 name=__codelineno-10-65 href=#__codelineno-10-65></a><span class=nt>ingress</span><span class=p>:</span>
</span><span id=__span-10-66><a id=__codelineno-10-66 name=__codelineno-10-66 href=#__codelineno-10-66></a><span class=w>  </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-10-67><a id=__codelineno-10-67 name=__codelineno-10-67 href=#__codelineno-10-67></a><span class=w>  </span><span class=nt>annotations</span><span class=p>:</span>
</span><span id=__span-10-68><a id=__codelineno-10-68 name=__codelineno-10-68 href=#__codelineno-10-68></a><span class=w>    </span><span class=nt>kubernetes.io/ingress.class</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
</span><span id=__span-10-69><a id=__codelineno-10-69 name=__codelineno-10-69 href=#__codelineno-10-69></a><span class=w>    </span><span class=nt>ingress.kubernetes.io/affinity</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">cookie</span>
</span><span id=__span-10-70><a id=__codelineno-10-70 name=__codelineno-10-70 href=#__codelineno-10-70></a><span class=w>  </span><span class=nt>rules</span><span class=p>:</span>
</span><span id=__span-10-71><a id=__codelineno-10-71 name=__codelineno-10-71 href=#__codelineno-10-71></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>host</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">keycloak.&lt;ROOT_DOMAIN&gt;</span>
</span><span id=__span-10-72><a id=__codelineno-10-72 name=__codelineno-10-72 href=#__codelineno-10-72></a><span class=w>      </span><span class=nt>paths</span><span class=p>:</span>
</span><span id=__span-10-73><a id=__codelineno-10-73 name=__codelineno-10-73 href=#__codelineno-10-73></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=s>'{{</span><span class=nv> </span><span class=s>tpl</span><span class=nv> </span><span class=s>.Values.http.relativePath</span><span class=nv> </span><span class=s>$</span><span class=nv> </span><span class=s>|</span><span class=nv> </span><span class=s>trimSuffix</span><span class=nv> </span><span class=s>"/"</span><span class=nv> </span><span class=s>}}/'</span>
</span><span id=__span-10-74><a id=__codelineno-10-74 name=__codelineno-10-74 href=#__codelineno-10-74></a><span class=w>          </span><span class=nt>pathType</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Prefix</span>
</span><span id=__span-10-75><a id=__codelineno-10-75 name=__codelineno-10-75 href=#__codelineno-10-75></a>
</span><span id=__span-10-76><a id=__codelineno-10-76 name=__codelineno-10-76 href=#__codelineno-10-76></a><span class=c1># This block should be uncommented if you set Keycloak to OpenShift and change the host field</span>
</span><span id=__span-10-77><a id=__codelineno-10-77 name=__codelineno-10-77 href=#__codelineno-10-77></a><span class=c1># route:</span>
</span><span id=__span-10-78><a id=__codelineno-10-78 name=__codelineno-10-78 href=#__codelineno-10-78></a><span class=c1>#   enabled: false</span>
</span><span id=__span-10-79><a id=__codelineno-10-79 name=__codelineno-10-79 href=#__codelineno-10-79></a><span class=c1>#   # Path for the Route</span>
</span><span id=__span-10-80><a id=__codelineno-10-80 name=__codelineno-10-80 href=#__codelineno-10-80></a><span class=c1>#   path: '/'</span>
</span><span id=__span-10-81><a id=__codelineno-10-81 name=__codelineno-10-81 href=#__codelineno-10-81></a><span class=c1>#   # Host name for the Route</span>
</span><span id=__span-10-82><a id=__codelineno-10-82 name=__codelineno-10-82 href=#__codelineno-10-82></a><span class=c1>#   host: "keycloak.&lt;ROOT_DOMAIN&gt;"</span>
</span><span id=__span-10-83><a id=__codelineno-10-83 name=__codelineno-10-83 href=#__codelineno-10-83></a><span class=c1>#   # TLS configuration</span>
</span><span id=__span-10-84><a id=__codelineno-10-84 name=__codelineno-10-84 href=#__codelineno-10-84></a><span class=c1>#   tls:</span>
</span><span id=__span-10-85><a id=__codelineno-10-85 name=__codelineno-10-85 href=#__codelineno-10-85></a><span class=c1>#     enabled: true</span>
</span><span id=__span-10-86><a id=__codelineno-10-86 name=__codelineno-10-86 href=#__codelineno-10-86></a>
</span><span id=__span-10-87><a id=__codelineno-10-87 name=__codelineno-10-87 href=#__codelineno-10-87></a><span class=nt>resources</span><span class=p>:</span>
</span><span id=__span-10-88><a id=__codelineno-10-88 name=__codelineno-10-88 href=#__codelineno-10-88></a><span class=w>  </span><span class=nt>limits</span><span class=p>:</span>
</span><span id=__span-10-89><a id=__codelineno-10-89 name=__codelineno-10-89 href=#__codelineno-10-89></a><span class=w>    </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s>"2048Mi"</span>
</span><span id=__span-10-90><a id=__codelineno-10-90 name=__codelineno-10-90 href=#__codelineno-10-90></a><span class=w>  </span><span class=nt>requests</span><span class=p>:</span>
</span><span id=__span-10-91><a id=__codelineno-10-91 name=__codelineno-10-91 href=#__codelineno-10-91></a><span class=w>    </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s>"50m"</span>
</span><span id=__span-10-92><a id=__codelineno-10-92 name=__codelineno-10-92 href=#__codelineno-10-92></a><span class=w>    </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s>"512Mi"</span>
</span><span id=__span-10-93><a id=__codelineno-10-93 name=__codelineno-10-93 href=#__codelineno-10-93></a>
</span><span id=__span-10-94><a id=__codelineno-10-94 name=__codelineno-10-94 href=#__codelineno-10-94></a><span class=c1># Check database readiness at startup</span>
</span><span id=__span-10-95><a id=__codelineno-10-95 name=__codelineno-10-95 href=#__codelineno-10-95></a><span class=nt>dbchecker</span><span class=p>:</span>
</span><span id=__span-10-96><a id=__codelineno-10-96 name=__codelineno-10-96 href=#__codelineno-10-96></a><span class=w>  </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-10-97><a id=__codelineno-10-97 name=__codelineno-10-97 href=#__codelineno-10-97></a>
</span><span id=__span-10-98><a id=__codelineno-10-98 name=__codelineno-10-98 href=#__codelineno-10-98></a><span class=nt>database</span><span class=p>:</span>
</span><span id=__span-10-99><a id=__codelineno-10-99 name=__codelineno-10-99 href=#__codelineno-10-99></a><span class=w>  </span><span class=nt>vendor</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">postgres</span>
</span><span id=__span-10-100><a id=__codelineno-10-100 name=__codelineno-10-100 href=#__codelineno-10-100></a><span class=w>  </span><span class=nt>existingSecret</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">keycloak-postgresql</span>
</span><span id=__span-10-101><a id=__codelineno-10-101 name=__codelineno-10-101 href=#__codelineno-10-101></a><span class=w>  </span><span class=nt>hostname</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">keycloak-postgresql</span>
</span><span id=__span-10-102><a id=__codelineno-10-102 name=__codelineno-10-102 href=#__codelineno-10-102></a><span class=w>  </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5432</span>
</span><span id=__span-10-103><a id=__codelineno-10-103 name=__codelineno-10-103 href=#__codelineno-10-103></a><span class=w>  </span><span class=nt>username</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">admin</span>
</span><span id=__span-10-104><a id=__codelineno-10-104 name=__codelineno-10-104 href=#__codelineno-10-104></a><span class=w>  </span><span class=nt>database</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">keycloak</span>
</span></code></pre></div> </details> </li> <li> <p>Upgrade the Keycloak Helm chart:</p> <div class="admonition note"> <p class=admonition-title>Note</p> <ul> <li>The Helm chart is substituted with the new Keyacloak.X instance.</li> <li>Change the namespace and the values file name if required.</li> </ul> </div> <div class="language-bash highlight"><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a>helm<span class=w> </span>upgrade<span class=w> </span>keycloak<span class=w> </span>codecentric/keycloakx<span class=w> </span>--version<span class=w> </span><span class=m>1</span>.6.0<span class=w> </span>--values<span class=w> </span>keycloak-values.yaml<span class=w> </span>-n<span class=w> </span>security
</span></code></pre></div> <div class="admonition note"> <p class=admonition-title>Note</p> <p>If there are error messages when upgrading via Helm, make sure that <code>StatefulSets</code> are removed. If they are removed and the error still persists, try to add the <code>--force</code> flag to the Helm command:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a>helm<span class=w> </span>upgrade<span class=w> </span>keycloak<span class=w> </span>codecentric/keycloakx<span class=w> </span>--version<span class=w> </span><span class=m>1</span>.6.0<span class=w> </span>--values<span class=w> </span>keycloak-values.yaml<span class=w> </span>-n<span class=w> </span>security<span class=w> </span>--force
</span></code></pre></div> </div> </li> </ol> <h3 id=install-postgres>Install Postgres<a class=headerlink href=#install-postgres title="Permanent link">âš“ï¸Ž</a></h3> <ol> <li> <p>Add Bitnami chart repository and update Helm repos:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-13-1><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a>helm<span class=w> </span>repo<span class=w> </span>add<span class=w> </span>bitnami<span class=w> </span>https://charts.bitnami.com/bitnami
</span><span id=__span-13-2><a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a>helm<span class=w> </span>repo<span class=w> </span>update
</span></code></pre></div> </li> <li> <p>Create values for Postgres:</p> <div class="admonition note"> <p class=admonition-title>Note</p> <ul> <li>Postgres v.11 and Postgres v.14.5 are not compatible.</li> <li>Postgres image will be upgraded to a minor release v.11.17.</li> <li><code>fullnameOverride: "keycloak-postgresql"</code> sets the name of the Postgres StatefulSet. It must be the same as in the previous <code>StatefulSet</code>.</li> </ul> </div> <details> <summary><b>View: postgres-values.yaml</b></summary> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-14-1><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=nt>fullnameOverride</span><span class=p>:</span><span class=w> </span><span class=s>"keycloak-postgresql"</span>
</span><span id=__span-14-2><a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a>
</span><span id=__span-14-3><a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a><span class=c1># PostgreSQL read only replica parameters</span>
</span><span id=__span-14-4><a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a><span class=nt>readReplicas</span><span class=p>:</span>
</span><span id=__span-14-5><a id=__codelineno-14-5 name=__codelineno-14-5 href=#__codelineno-14-5></a><span class=w>  </span><span class=c1># Number of PostgreSQL read only replicas</span>
</span><span id=__span-14-6><a id=__codelineno-14-6 name=__codelineno-14-6 href=#__codelineno-14-6></a><span class=w>  </span><span class=nt>replicaCount</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
</span><span id=__span-14-7><a id=__codelineno-14-7 name=__codelineno-14-7 href=#__codelineno-14-7></a>
</span><span id=__span-14-8><a id=__codelineno-14-8 name=__codelineno-14-8 href=#__codelineno-14-8></a><span class=nt>global</span><span class=p>:</span>
</span><span id=__span-14-9><a id=__codelineno-14-9 name=__codelineno-14-9 href=#__codelineno-14-9></a><span class=w>  </span><span class=nt>postgresql</span><span class=p>:</span>
</span><span id=__span-14-10><a id=__codelineno-14-10 name=__codelineno-14-10 href=#__codelineno-14-10></a><span class=w>    </span><span class=nt>auth</span><span class=p>:</span>
</span><span id=__span-14-11><a id=__codelineno-14-11 name=__codelineno-14-11 href=#__codelineno-14-11></a><span class=w>      </span><span class=nt>username</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">admin</span>
</span><span id=__span-14-12><a id=__codelineno-14-12 name=__codelineno-14-12 href=#__codelineno-14-12></a><span class=w>      </span><span class=nt>existingSecret</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">keycloak-postgresql</span>
</span><span id=__span-14-13><a id=__codelineno-14-13 name=__codelineno-14-13 href=#__codelineno-14-13></a><span class=w>      </span><span class=nt>secretKeys</span><span class=p>:</span>
</span><span id=__span-14-14><a id=__codelineno-14-14 name=__codelineno-14-14 href=#__codelineno-14-14></a><span class=w>        </span><span class=nt>adminPasswordKey</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">postgres-password</span>
</span><span id=__span-14-15><a id=__codelineno-14-15 name=__codelineno-14-15 href=#__codelineno-14-15></a><span class=w>        </span><span class=nt>userPasswordKey</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">password</span>
</span><span id=__span-14-16><a id=__codelineno-14-16 name=__codelineno-14-16 href=#__codelineno-14-16></a><span class=w>      </span><span class=nt>database</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">keycloak</span>
</span><span id=__span-14-17><a id=__codelineno-14-17 name=__codelineno-14-17 href=#__codelineno-14-17></a>
</span><span id=__span-14-18><a id=__codelineno-14-18 name=__codelineno-14-18 href=#__codelineno-14-18></a><span class=nt>image</span><span class=p>:</span>
</span><span id=__span-14-19><a id=__codelineno-14-19 name=__codelineno-14-19 href=#__codelineno-14-19></a><span class=w>  </span><span class=nt>registry</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">docker.io</span>
</span><span id=__span-14-20><a id=__codelineno-14-20 name=__codelineno-14-20 href=#__codelineno-14-20></a><span class=w>  </span><span class=nt>repository</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">bitnami/postgresql</span>
</span><span id=__span-14-21><a id=__codelineno-14-21 name=__codelineno-14-21 href=#__codelineno-14-21></a><span class=w>  </span><span class=nt>tag</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">11.17.0-debian-11-r3</span>
</span><span id=__span-14-22><a id=__codelineno-14-22 name=__codelineno-14-22 href=#__codelineno-14-22></a>
</span><span id=__span-14-23><a id=__codelineno-14-23 name=__codelineno-14-23 href=#__codelineno-14-23></a><span class=nt>auth</span><span class=p>:</span>
</span><span id=__span-14-24><a id=__codelineno-14-24 name=__codelineno-14-24 href=#__codelineno-14-24></a><span class=w>  </span><span class=nt>existingSecret</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">keycloak-postgresql</span>
</span><span id=__span-14-25><a id=__codelineno-14-25 name=__codelineno-14-25 href=#__codelineno-14-25></a><span class=w>  </span><span class=nt>secretKeys</span><span class=p>:</span>
</span><span id=__span-14-26><a id=__codelineno-14-26 name=__codelineno-14-26 href=#__codelineno-14-26></a><span class=w>    </span><span class=nt>adminPasswordKey</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">postgres-password</span>
</span><span id=__span-14-27><a id=__codelineno-14-27 name=__codelineno-14-27 href=#__codelineno-14-27></a><span class=w>    </span><span class=nt>userPasswordKey</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">password</span>
</span><span id=__span-14-28><a id=__codelineno-14-28 name=__codelineno-14-28 href=#__codelineno-14-28></a>
</span><span id=__span-14-29><a id=__codelineno-14-29 name=__codelineno-14-29 href=#__codelineno-14-29></a><span class=nt>primary</span><span class=p>:</span>
</span><span id=__span-14-30><a id=__codelineno-14-30 name=__codelineno-14-30 href=#__codelineno-14-30></a><span class=w>  </span><span class=nt>persistence</span><span class=p>:</span>
</span><span id=__span-14-31><a id=__codelineno-14-31 name=__codelineno-14-31 href=#__codelineno-14-31></a><span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-14-32><a id=__codelineno-14-32 name=__codelineno-14-32 href=#__codelineno-14-32></a><span class=w>    </span><span class=nt>size</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3Gi</span>
</span><span id=__span-14-33><a id=__codelineno-14-33 name=__codelineno-14-33 href=#__codelineno-14-33></a><span class=w>    </span><span class=c1># If the StorageClass with reclaimPolicy: Retain is used, install an additional StorageClass before installing PostgreSQL</span>
</span><span id=__span-14-34><a id=__codelineno-14-34 name=__codelineno-14-34 href=#__codelineno-14-34></a><span class=w>    </span><span class=c1># (the code is given below).</span>
</span><span id=__span-14-35><a id=__codelineno-14-35 name=__codelineno-14-35 href=#__codelineno-14-35></a><span class=w>    </span><span class=c1># If the default StorageClass will be used - change "gp2-retain" to "gp2"</span>
</span><span id=__span-14-36><a id=__codelineno-14-36 name=__codelineno-14-36 href=#__codelineno-14-36></a><span class=w>    </span><span class=nt>storageClass</span><span class=p>:</span><span class=w> </span><span class=s>"gp2-retain"</span>
</span></code></pre></div> </details> </li> <li> <p>Install the Postgres database chart:</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Change the namespace and the values file name if required.</p> </div> <div class="language-bash highlight"><pre><span></span><code><span id=__span-15-1><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a>helm<span class=w> </span>install<span class=w> </span>postgresql<span class=w> </span>bitnami/postgresql<span class=w> </span><span class=se>\</span>
</span><span id=__span-15-2><a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a>--version<span class=w> </span><span class=m>11</span>.7.6<span class=w> </span><span class=se>\</span>
</span><span id=__span-15-3><a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a>--values<span class=w> </span>postgres-values.yaml<span class=w> </span><span class=se>\</span>
</span><span id=__span-15-4><a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a>--namespace<span class=w> </span>security
</span></code></pre></div> </li> <li> <p>Log in to Keycloak and check that everything works as expected.</p> </li> </ol> <h3 id=clean-and-analyze-database>Clean and Analyze Database<a class=headerlink href=#clean-and-analyze-database title="Permanent link">âš“ï¸Ž</a></h3> <p>Optionally, run the <a href=https://www.postgresql.org/docs/current/app-vacuumdb.html>vacuumdb</a> application on the database, to recover space occupied by "dead tuples" in the tables, analyze the contents of database tables, and collect statistics for PostgreSQL query engine to improve performance:</p> <p></p><div class="language-bash highlight"><pre><span></span><code><span id=__span-16-1><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a><span class=nv>PGPASSWORD</span><span class=o>=</span><span class=s2>"</span><span class=si>${</span><span class=nv>postgresql_postgres</span><span class=p>-password</span><span class=si>}</span><span class=s2>"</span><span class=w> </span>vacuumdb<span class=w> </span>--analyze<span class=w> </span>--verbose<span class=w> </span>-d<span class=w> </span>keycloak<span class=w> </span>-U<span class=w> </span>postgres
</span></code></pre></div> For all databases, run the following command: <div class="language-bash highlight"><pre><span></span><code><span id=__span-17-1><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a><span class=nv>PGPASSWORD</span><span class=o>=</span><span class=s2>"</span><span class=si>${</span><span class=nv>postgresql_postgres</span><span class=p>-password</span><span class=si>}</span><span class=s2>"</span><span class=w> </span>vacuumdb<span class=w> </span>--analyze<span class=w> </span>--verbose<span class=w> </span>--all<span class=w> </span>-U<span class=w> </span>postgres
</span></code></pre></div> <h2 id=migrate-postgres-database-from-postgres-v11x-to-v145>Migrate Postgres Database From Postgres v.11.x to v.14.5 <a name=KPM></a><a class=headerlink href=#migrate-postgres-database-from-postgres-v11x-to-v145 title="Permanent link">âš“ï¸Ž</a></h2> <div class="admonition info"> <p class=admonition-title>Info</p> <p>There is a <a href=#Pdms>Postgres database migration script</a> at the end of this tutorial. Please read the section below before using the script.</p> </div> <p>To upgrade Keycloak by migrating Postgres database from Postgres v.11.x to v.14.5, perform the steps described in the <a href=#Prrqsts>Prerequisites</a> section of this tutorial, and then perform the following steps:</p> <h3 id=export-postgres-databases>Export Postgres Databases<a class=headerlink href=#export-postgres-databases title="Permanent link">âš“ï¸Ž</a></h3> <ol> <li> <p>Log in to the current Keycloak Postgres pod and create a logical backup of all roles and databases using the <a href=https://www.postgresql.org/docs/current/app-pg-dumpall.html>pg_dumpall</a> application. If there is no access to the Postgres Superuser, backup the Keycloak database with the <a href=https://www.postgresql.org/docs/current/app-pgdump.html>pg_dump</a> application:</p> <div class="admonition note"> <p class=admonition-title>Note</p> <ul> <li>The secret key <code>postgresql-postgres-password</code> is for the <code>postgres</code> Superuser and <code>postgresql-password</code> is for <code>admin</code> user. The <code>admin</code> user is indicated by default in the Postgres Helm chart.<br> The <code>admin</code> user may not have enough permissions to dump all Postgres databases and roles, so the preferred option for exporting all objects is using the <code>pg_dumpall</code> tool with the <code>postgres</code> Superuser.<br></li> <li>If the <code>PGPASSWORD</code> variable is not specified before using the <code>pg_dumpall</code> tool, you will be prompted to enter a password for each database during the export.</li> <li>If the <code>-l keycloak</code> parameter is specified, <code>pg_dumpall</code> will connect to the <code>keycloak</code> database for dumping global objects and discovering what other databases should be dumped. By default, <code>pg_dumpall</code> will try to connect to <code>postgres</code> or <code>template1</code> databases. This parameter is optional.</li> <li>The <code>pg_dumpall --clean</code> option adds SQL commands to the dumped file for dropping databases before recreating them during import, as well as <code>DROP</code> commands for roles and tablespaces (<code>pg_dump</code> also has this option). If the <code>--clean</code> parameter is specified, connect to the <code>postgres</code> database initially during import via <code>psql</code>. The <code>psql</code> script will attempt to drop other databases immediately, and that will fail for the database you are connected to. This flag is optional, and it is not included into this tutorial.</li> </ul> </div> <div class="language-bash highlight"><pre><span></span><code><span id=__span-18-1><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a><span class=nv>PGPASSWORD</span><span class=o>=</span><span class=s2>"</span><span class=si>${</span><span class=nv>postgresql_postgres</span><span class=p>-password</span><span class=si>}</span><span class=s2>"</span><span class=w> </span>pg_dumpall<span class=w> </span>-h<span class=w> </span>localhost<span class=w> </span>-p<span class=w> </span><span class=m>5432</span><span class=w> </span>-U<span class=w> </span>postgres<span class=w> </span>-l<span class=w> </span>keycloak<span class=w> </span>&gt;<span class=w> </span>/tmp/keycloak_wildfly_db_dump.sql
</span></code></pre></div> <div class="admonition note"> <p class=admonition-title>Note</p> <p>If there is no working password for the <code>postgres</code> Superuser, try the <code>admin</code> user using the <a href=https://www.postgresql.org/docs/current/app-pgdump.html>pg_dump</a> tool to export the <code>keycloak</code> database without global roles:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-19-1><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a><span class=nv>PGPASSWORD</span><span class=o>=</span><span class=s2>"</span><span class=si>${</span><span class=nv>postgresql_password</span><span class=si>}</span><span class=s2>"</span><span class=w> </span>pg_dump<span class=w> </span>-h<span class=w> </span>localhost<span class=w> </span>-p<span class=w> </span><span class=m>5432</span><span class=w> </span>-U<span class=w> </span>admin<span class=w> </span>-d<span class=w> </span>keycloak<span class=w> </span>&gt;<span class=w> </span>/tmp/keycloak_wildfly_db_dump.sql
</span></code></pre></div> </div> <div class="admonition info"> <p class=admonition-title>Info</p> <p>Double-check that the contents of the dumped file is not empty. It usually contains more than 4000 lines.</p> </div> </li> <li> <p>Copy the file with the database dump to a local machine. Since <code>tar</code> may not be present in the pod and <code>kubectl cp</code> will not work without <code>tar</code>, use the following command:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-20-1><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a>kubectl<span class=w> </span><span class=nb>exec</span><span class=w> </span>-n<span class=w> </span>security<span class=w> </span><span class=si>${</span><span class=nv>postgresql_pod</span><span class=si>}</span><span class=w> </span>--<span class=w> </span>cat<span class=w> </span>/tmp/keycloak_wildfly_db_dump.sql<span class=w>  </span>&gt;<span class=w> </span>keycloak_wildfly_db_dump.sql
</span></code></pre></div> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Please find below the alternative commands for exporting the database to the local machine without copying the file to a pod for Postgres and admin users:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-21-1><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a>kubectl<span class=w> </span><span class=nb>exec</span><span class=w> </span>-n<span class=w> </span>security<span class=w> </span><span class=si>${</span><span class=nv>postgresql_pod</span><span class=si>}</span><span class=w> </span><span class=s2>"--"</span><span class=w> </span>sh<span class=w> </span>-c<span class=w> </span><span class=s2>"PGPASSWORD='"</span><span class=si>${</span><span class=nv>postgresql_postgres</span><span class=p>-password</span><span class=si>}</span><span class=s2>"' pg_dumpall -h localhost -p 5432 -U postgres"</span><span class=w> </span>&gt;<span class=w> </span>keycloak_wildfly_db_dump.sql
</span><span id=__span-21-2><a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a>kubectl<span class=w> </span><span class=nb>exec</span><span class=w> </span>-n<span class=w> </span>security<span class=w> </span><span class=si>${</span><span class=nv>postgresql_pod</span><span class=si>}</span><span class=w> </span><span class=s2>"--"</span><span class=w> </span>sh<span class=w> </span>-c<span class=w> </span><span class=s2>"PGPASSWORD='"</span><span class=si>${</span><span class=nv>postgresql_password</span><span class=si>}</span><span class=s2>"' pg_dump -h localhost -p 5432 -U admin -d keycloak"</span><span class=w> </span>&gt;<span class=w> </span>keycloak_wildfly_db_dump.sql
</span></code></pre></div> </div> </li> <li> <p>Delete the dumped file from the pod for security reasons:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-22-1><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a>kubectl<span class=w> </span><span class=nb>exec</span><span class=w> </span>-n<span class=w> </span>security<span class=w> </span><span class=si>${</span><span class=nv>postgresql_pod</span><span class=si>}</span><span class=w> </span><span class=s2>"--"</span><span class=w> </span>sh<span class=w> </span>-c<span class=w> </span><span class=s2>"rm /tmp/keycloak_wildfly_db_dump.sql"</span>
</span></code></pre></div> </li> </ol> <h3 id=delete-keycloak-resources_1>Delete Keycloak Resources<a class=headerlink href=#delete-keycloak-resources_1 title="Permanent link">âš“ï¸Ž</a></h3> <ol> <li> <p>Delete all previous Keycloak resources along with the Postgres database and keycloak <code>StatefulSets</code>, <code>Ingress</code>, and custom resources via Helm, or via the tool used for their deployment.</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-23-1><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a>helm<span class=w> </span>list<span class=w> </span>-n<span class=w> </span>security
</span><span id=__span-23-2><a id=__codelineno-23-2 name=__codelineno-23-2 href=#__codelineno-23-2></a>helm<span class=w> </span>delete<span class=w> </span>keycloak<span class=w> </span>-n<span class=w> </span>security
</span></code></pre></div> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>Don't delete the whole namespace. Keep the <code>keycloak-postgresql</code> and <code>keycloak-admin-creds</code> secrets.</p> </div> </li> <li> <p>Delete the volume in AWS, from which a snapshot has been created. Then delete the PVC:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-24-1><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a>kubectl<span class=w> </span>delete<span class=w> </span>pvc<span class=w> </span>data-keycloak-postgresql-0<span class=w> </span>-n<span class=w> </span>security
</span></code></pre></div> </li> </ol> <h3 id=install-postgres_1>Install Postgres<a class=headerlink href=#install-postgres_1 title="Permanent link">âš“ï¸Ž</a></h3> <ol> <li> <p>Add Bitnami chart repository and update Helm repos:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-25-1><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a>helm<span class=w> </span>repo<span class=w> </span>add<span class=w> </span>bitnami<span class=w> </span>https://charts.bitnami.com/bitnami
</span><span id=__span-25-2><a id=__codelineno-25-2 name=__codelineno-25-2 href=#__codelineno-25-2></a>helm<span class=w> </span>repo<span class=w> </span>update
</span></code></pre></div> </li> <li> <p>Create Postgres values:</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p><code>fullnameOverride: "keycloak-postgresql"</code> sets the name of the Postgres StatefulSet. It must be same as in the previous <code>StatefulSet</code>.</p> </div> <details> <summary><b>View: postgres-values.yaml</b></summary> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-26-1><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a><span class=nt>nameOverride</span><span class=p>:</span><span class=w> </span><span class=s>"keycloak-postgresql"</span>
</span><span id=__span-26-2><a id=__codelineno-26-2 name=__codelineno-26-2 href=#__codelineno-26-2></a>
</span><span id=__span-26-3><a id=__codelineno-26-3 name=__codelineno-26-3 href=#__codelineno-26-3></a><span class=c1># PostgreSQL read only replica parameters</span>
</span><span id=__span-26-4><a id=__codelineno-26-4 name=__codelineno-26-4 href=#__codelineno-26-4></a><span class=nt>readReplicas</span><span class=p>:</span>
</span><span id=__span-26-5><a id=__codelineno-26-5 name=__codelineno-26-5 href=#__codelineno-26-5></a><span class=w>  </span><span class=c1># Number of PostgreSQL read only replicas</span>
</span><span id=__span-26-6><a id=__codelineno-26-6 name=__codelineno-26-6 href=#__codelineno-26-6></a><span class=w>  </span><span class=nt>replicaCount</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
</span><span id=__span-26-7><a id=__codelineno-26-7 name=__codelineno-26-7 href=#__codelineno-26-7></a>
</span><span id=__span-26-8><a id=__codelineno-26-8 name=__codelineno-26-8 href=#__codelineno-26-8></a><span class=nt>global</span><span class=p>:</span>
</span><span id=__span-26-9><a id=__codelineno-26-9 name=__codelineno-26-9 href=#__codelineno-26-9></a><span class=w>  </span><span class=nt>postgresql</span><span class=p>:</span>
</span><span id=__span-26-10><a id=__codelineno-26-10 name=__codelineno-26-10 href=#__codelineno-26-10></a><span class=w>    </span><span class=nt>auth</span><span class=p>:</span>
</span><span id=__span-26-11><a id=__codelineno-26-11 name=__codelineno-26-11 href=#__codelineno-26-11></a><span class=w>      </span><span class=nt>username</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">admin</span>
</span><span id=__span-26-12><a id=__codelineno-26-12 name=__codelineno-26-12 href=#__codelineno-26-12></a><span class=w>      </span><span class=nt>existingSecret</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">keycloak-postgresql</span>
</span><span id=__span-26-13><a id=__codelineno-26-13 name=__codelineno-26-13 href=#__codelineno-26-13></a><span class=w>      </span><span class=nt>secretKeys</span><span class=p>:</span>
</span><span id=__span-26-14><a id=__codelineno-26-14 name=__codelineno-26-14 href=#__codelineno-26-14></a><span class=w>        </span><span class=nt>adminPasswordKey</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">postgres-password</span>
</span><span id=__span-26-15><a id=__codelineno-26-15 name=__codelineno-26-15 href=#__codelineno-26-15></a><span class=w>        </span><span class=nt>userPasswordKey</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">password</span>
</span><span id=__span-26-16><a id=__codelineno-26-16 name=__codelineno-26-16 href=#__codelineno-26-16></a><span class=w>      </span><span class=nt>database</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">keycloak</span>
</span><span id=__span-26-17><a id=__codelineno-26-17 name=__codelineno-26-17 href=#__codelineno-26-17></a>
</span><span id=__span-26-18><a id=__codelineno-26-18 name=__codelineno-26-18 href=#__codelineno-26-18></a><span class=nt>auth</span><span class=p>:</span>
</span><span id=__span-26-19><a id=__codelineno-26-19 name=__codelineno-26-19 href=#__codelineno-26-19></a><span class=w>  </span><span class=nt>existingSecret</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">keycloak-postgresql</span>
</span><span id=__span-26-20><a id=__codelineno-26-20 name=__codelineno-26-20 href=#__codelineno-26-20></a><span class=w>  </span><span class=nt>secretKeys</span><span class=p>:</span>
</span><span id=__span-26-21><a id=__codelineno-26-21 name=__codelineno-26-21 href=#__codelineno-26-21></a><span class=w>    </span><span class=nt>adminPasswordKey</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">postgres-password</span>
</span><span id=__span-26-22><a id=__codelineno-26-22 name=__codelineno-26-22 href=#__codelineno-26-22></a><span class=w>    </span><span class=nt>userPasswordKey</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">password</span>
</span><span id=__span-26-23><a id=__codelineno-26-23 name=__codelineno-26-23 href=#__codelineno-26-23></a>
</span><span id=__span-26-24><a id=__codelineno-26-24 name=__codelineno-26-24 href=#__codelineno-26-24></a><span class=nt>primary</span><span class=p>:</span>
</span><span id=__span-26-25><a id=__codelineno-26-25 name=__codelineno-26-25 href=#__codelineno-26-25></a><span class=w>  </span><span class=nt>persistence</span><span class=p>:</span>
</span><span id=__span-26-26><a id=__codelineno-26-26 name=__codelineno-26-26 href=#__codelineno-26-26></a><span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-26-27><a id=__codelineno-26-27 name=__codelineno-26-27 href=#__codelineno-26-27></a><span class=w>    </span><span class=nt>size</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3Gi</span>
</span><span id=__span-26-28><a id=__codelineno-26-28 name=__codelineno-26-28 href=#__codelineno-26-28></a><span class=w>    </span><span class=c1># If the StorageClass with reclaimPolicy: Retain is used, install an additional StorageClass before installing PostgreSQL</span>
</span><span id=__span-26-29><a id=__codelineno-26-29 name=__codelineno-26-29 href=#__codelineno-26-29></a><span class=w>    </span><span class=c1># (the code is given below).</span>
</span><span id=__span-26-30><a id=__codelineno-26-30 name=__codelineno-26-30 href=#__codelineno-26-30></a><span class=w>    </span><span class=c1># If the default StorageClass will be used - change "gp2-retain" to "gp2"</span>
</span><span id=__span-26-31><a id=__codelineno-26-31 name=__codelineno-26-31 href=#__codelineno-26-31></a><span class=w>    </span><span class=nt>storageClass</span><span class=p>:</span><span class=w> </span><span class=s>"gp2-retain"</span>
</span></code></pre></div> </details> </li> <li> <p>Install the Postgres database:</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Change the namespace and the values file name if required.</p> </div> <div class="language-bash highlight"><pre><span></span><code><span id=__span-27-1><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a>helm<span class=w> </span>install<span class=w> </span>postgresql<span class=w> </span>bitnami/postgresql<span class=w> </span><span class=se>\</span>
</span><span id=__span-27-2><a id=__codelineno-27-2 name=__codelineno-27-2 href=#__codelineno-27-2></a>--version<span class=w> </span><span class=m>11</span>.7.6<span class=w> </span><span class=se>\</span>
</span><span id=__span-27-3><a id=__codelineno-27-3 name=__codelineno-27-3 href=#__codelineno-27-3></a>--values<span class=w> </span>postgres-values.yaml<span class=w> </span><span class=se>\</span>
</span><span id=__span-27-4><a id=__codelineno-27-4 name=__codelineno-27-4 href=#__codelineno-27-4></a>--namespace<span class=w> </span>security
</span></code></pre></div> </li> <li> <p>Wait for the database to be ready.</p> </li> </ol> <h3 id=import-postgres-databases>Import Postgres Databases<a class=headerlink href=#import-postgres-databases title="Permanent link">âš“ï¸Ž</a></h3> <ol> <li> <p>Upload the database dump to the new Keycloak Postgres pod:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-28-1><a id=__codelineno-28-1 name=__codelineno-28-1 href=#__codelineno-28-1></a>cat<span class=w> </span>keycloak_wildfly_db_dump.sql<span class=w> </span><span class=p>|</span><span class=w> </span>kubectl<span class=w> </span><span class=nb>exec</span><span class=w> </span>-i<span class=w> </span>-n<span class=w> </span>security<span class=w> </span><span class=si>${</span><span class=nv>postgresql_pod</span><span class=si>}</span><span class=w> </span><span class=s2>"--"</span><span class=w> </span>sh<span class=w> </span>-c<span class=w> </span><span class=s2>"cat &gt; /tmp/keycloak_wildfly_db_dump.sql"</span>
</span></code></pre></div> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>Database import must be done before deploying Keycloak, because Keycloak will write its own data to the database during the start, and the import will partially fail.<br> If that happened, scale down the keycloak <code>StatefulSet</code>, and try to drop the Keycloak database in the Postgres pod:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-29-1><a id=__codelineno-29-1 name=__codelineno-29-1 href=#__codelineno-29-1></a>dropdb<span class=w> </span>-i<span class=w> </span>-e<span class=w> </span>keycloak<span class=w> </span>-p<span class=w> </span><span class=m>5432</span><span class=w> </span>-h<span class=w> </span>localhost<span class=w> </span>-U<span class=w> </span>postgres
</span></code></pre></div> <p>If there still are some conflicting objects like roles, drop them via the <a href=https://www.postgresql.org/docs/current/sql-droprole.html>DROP ROLE</a> command.</p> <p>If the previous steps do not help, downscale the Keycloak and Postgres <code>StatefulSets</code> and delete the attached <code>PVC</code> (save the <code>volumeID</code> before removing), and delete the volume on AWS if using <code>gp2-retain</code>. In case of using <code>gp2</code>, the volume will be deleted automatically after removing PVC. After that, redeploy the Postgres database, so that the new <code>PVC</code> is automatically created.</p> </div> </li> <li> <p>Import the <a href=https://www.postgresql.org/docs/current/backup-dump.html>SQL dump</a> file to the Postgres database cluster:</p> <div class="admonition info"> <p class=admonition-title>Info</p> <p>Since the databases were exported in the <code>sql</code> format, the <a href=https://www.postgresql.org/docs/current/app-psql.html>psql</a> tool will be used to restore (reload) them. <a href=https://www.postgresql.org/docs/current/app-pgrestore.html>pg_restore</a> does not support this plain-text format.</p> </div> <ul> <li> <p>If the entire Postgres database cluster was migrated with the <code>postgres</code> Superuser using <code>pg_dumpall</code>, use the import command without indicating the database:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-30-1><a id=__codelineno-30-1 name=__codelineno-30-1 href=#__codelineno-30-1></a>psql<span class=w> </span>-U<span class=w> </span>postgres<span class=w> </span>-f<span class=w> </span>/tmp/keycloak_wildfly_db_dump.sql
</span></code></pre></div> </li> </ul> <ul> <li> <p>If the database was migrated with the <code>admin</code> user using <code>pg_dump</code>, the <code>postgres</code> Superuser still can be used to restore it, but, in this case, a database must be indicated:</p> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>If the database name was not indicated during the import for the file dumped with <code>pg_dump</code>, the <code>psql</code> tool will import this database to a default Postgres database called <code>postgres</code>.</p> </div> <div class="language-bash highlight"><pre><span></span><code><span id=__span-31-1><a id=__codelineno-31-1 name=__codelineno-31-1 href=#__codelineno-31-1></a>psql<span class=w> </span>-U<span class=w> </span>postgres<span class=w> </span>-d<span class=w> </span>keycloak<span class=w> </span>-f<span class=w> </span>/tmp/keycloak_wildfly_db_dump.sql
</span></code></pre></div> </li> </ul> <ul> <li> <p>If the <code>postgres</code> Superuser is not accessible in the Postgres pod, run the command under the <code>admin</code> or any other user that has the database permissions. In this case, indicate the database as well:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-32-1><a id=__codelineno-32-1 name=__codelineno-32-1 href=#__codelineno-32-1></a>psql<span class=w> </span>-U<span class=w> </span>admin<span class=w> </span>-d<span class=w> </span>keycloak<span class=w> </span>-f<span class=w> </span>/tmp/keycloak_wildfly_db_dump.sql
</span></code></pre></div> </li> </ul> </li> <li> <p>After a successful import, delete the dump file from the pod for security reasons:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-33-1><a id=__codelineno-33-1 name=__codelineno-33-1 href=#__codelineno-33-1></a>kubectl<span class=w> </span><span class=nb>exec</span><span class=w> </span>-n<span class=w> </span>security<span class=w> </span><span class=si>${</span><span class=nv>postgresql_pod</span><span class=si>}</span><span class=w> </span><span class=s2>"--"</span><span class=w> </span>sh<span class=w> </span>-c<span class=w> </span><span class=s2>"rm /tmp/keycloak_wildfly_db_dump.sql"</span>
</span></code></pre></div> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Please find below the alternative commands for importing the database from the local machine to the pod without storing the backup on a pod for <code>postgres</code> or <code>admin</code> users:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-34-1><a id=__codelineno-34-1 name=__codelineno-34-1 href=#__codelineno-34-1></a>cat<span class=w> </span><span class=s2>"keycloak_wildfly_db_dump.sql"</span><span class=w> </span><span class=p>|</span><span class=w> </span>kubectl<span class=w> </span><span class=nb>exec</span><span class=w> </span>-i<span class=w> </span>-n<span class=w> </span><span class=s2>"</span><span class=si>${</span><span class=nv>keycloak_namespace</span><span class=si>}</span><span class=s2>"</span><span class=w> </span><span class=s2>"</span><span class=si>${</span><span class=nv>postgres_pod_name</span><span class=si>}</span><span class=s2>"</span><span class=w> </span><span class=s2>"--"</span><span class=w> </span>sh<span class=w> </span>-c<span class=w> </span><span class=s2>"cat | PGPASSWORD='"</span><span class=si>${</span><span class=nv>postgresql_superuser_password</span><span class=si>}</span><span class=s2>"' psql -h "</span><span class=si>${</span><span class=nv>db_host</span><span class=si>}</span><span class=s2>" -p "</span><span class=si>${</span><span class=nv>db_port</span><span class=si>}</span><span class=s2>" -U "</span><span class=si>${</span><span class=nv>postgres_username</span><span class=si>}</span><span class=s2>""</span>
</span><span id=__span-34-2><a id=__codelineno-34-2 name=__codelineno-34-2 href=#__codelineno-34-2></a>cat<span class=w> </span><span class=s2>"keycloak_wildfly_db_dump.sql"</span><span class=w> </span><span class=p>|</span><span class=w> </span>kubectl<span class=w> </span><span class=nb>exec</span><span class=w> </span>-i<span class=w> </span>-n<span class=w> </span><span class=s2>"</span><span class=si>${</span><span class=nv>keycloak_namespace</span><span class=si>}</span><span class=s2>"</span><span class=w> </span><span class=s2>"</span><span class=si>${</span><span class=nv>postgres_pod_name</span><span class=si>}</span><span class=s2>"</span><span class=w> </span><span class=s2>"--"</span><span class=w> </span>sh<span class=w> </span>-c<span class=w> </span><span class=s2>"cat | PGPASSWORD='"</span><span class=si>${</span><span class=nv>postgresql_superuser_password</span><span class=si>}</span><span class=s2>"' psql -h "</span><span class=si>${</span><span class=nv>db_host</span><span class=si>}</span><span class=s2>" -p "</span><span class=si>${</span><span class=nv>db_port</span><span class=si>}</span><span class=s2>" -U "</span><span class=si>${</span><span class=nv>postgres_username</span><span class=si>}</span><span class=s2>" -d "</span><span class=si>${</span><span class=nv>database_name</span><span class=si>}</span><span class=s2>""</span>
</span><span id=__span-34-3><a id=__codelineno-34-3 name=__codelineno-34-3 href=#__codelineno-34-3></a>cat<span class=w> </span><span class=s2>"keycloak_wildfly_db_dump.sql"</span><span class=w> </span><span class=p>|</span><span class=w> </span>kubectl<span class=w> </span><span class=nb>exec</span><span class=w> </span>-i<span class=w> </span>-n<span class=w> </span><span class=s2>"</span><span class=si>${</span><span class=nv>keycloak_namespace</span><span class=si>}</span><span class=s2>"</span><span class=w> </span><span class=s2>"</span><span class=si>${</span><span class=nv>postgres_pod_name</span><span class=si>}</span><span class=s2>"</span><span class=w> </span><span class=s2>"--"</span><span class=w> </span>sh<span class=w> </span>-c<span class=w> </span><span class=s2>"cat | PGPASSWORD='"</span><span class=si>${</span><span class=nv>postgresql_admin_password</span><span class=si>}</span><span class=s2>"' psql -h "</span><span class=si>${</span><span class=nv>db_host</span><span class=si>}</span><span class=s2>" -p "</span><span class=si>${</span><span class=nv>db_port</span><span class=si>}</span><span class=s2>" -U "</span><span class=si>${</span><span class=nv>postgres_username</span><span class=si>}</span><span class=s2>" -d "</span><span class=si>${</span><span class=nv>database_name</span><span class=si>}</span><span class=s2>""</span>
</span></code></pre></div> </div> </li> </ol> <h3 id=install-keycloak>Install Keycloak<a class=headerlink href=#install-keycloak title="Permanent link">âš“ï¸Ž</a></h3> <ol> <li> <p>Make sure the Keycloak chart repository is added:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-35-1><a id=__codelineno-35-1 name=__codelineno-35-1 href=#__codelineno-35-1></a>helm<span class=w> </span>repo<span class=w> </span>add<span class=w> </span>codecentric<span class=w> </span>https://codecentric.github.io/helm-charts
</span><span id=__span-35-2><a id=__codelineno-35-2 name=__codelineno-35-2 href=#__codelineno-35-2></a>helm<span class=w> </span>repo<span class=w> </span>update
</span></code></pre></div> </li> <li> <p>Create Keycloak values:</p> <div class="admonition note"> <p class=admonition-title>Note</p> <ul> <li><code>nameOverride: "keycloak"</code> sets the name of the Keycloak pod. It must be the same Keycloak name as in the previous <code>StatefulSet</code>.</li> <li>Change Ingress host name to the Keycloak host name.</li> <li><code>hostname: keycloak-postgresql</code> is the hostname of the pod with the Postgres database that is the same as Postgres StatefulSet name, for example, <code>keycloak-postgresql</code>.</li> <li><code>"/opt/keycloak/bin/kc.sh start --auto-build"</code> was used in the legacy Keycloak version. However, it is no longer required in the new Keycloak version since it is <a href=https://www.keycloak.org/docs/latest/upgrading/index.html#changes-to-the-server-configuration-and-startup>deprecated</a> and used by default.</li> <li> <p>Optionally, use the following command for applying the old Keycloak theme:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-36-1><a id=__codelineno-36-1 name=__codelineno-36-1 href=#__codelineno-36-1></a>bin/kc.sh<span class=w> </span>start<span class=w> </span>--features-disabled<span class=o>=</span>admin2
</span></code></pre></div> </li> </ul> </div> <div class="admonition info"> <p class=admonition-title>Info</p> <p><a href=https://www.keycloak.org/docs/latest/upgrading/index.html#automatic-relational-database-migration>Automatic database migration</a> will start after the Keycloak installation.</p> </div> <details> <summary><b>View: keycloak-values.yaml</b></summary> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-37-1><a id=__codelineno-37-1 name=__codelineno-37-1 href=#__codelineno-37-1></a><span class=nt>nameOverride</span><span class=p>:</span><span class=w> </span><span class=s>"keycloak"</span>
</span><span id=__span-37-2><a id=__codelineno-37-2 name=__codelineno-37-2 href=#__codelineno-37-2></a>
</span><span id=__span-37-3><a id=__codelineno-37-3 name=__codelineno-37-3 href=#__codelineno-37-3></a><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
</span><span id=__span-37-4><a id=__codelineno-37-4 name=__codelineno-37-4 href=#__codelineno-37-4></a>
</span><span id=__span-37-5><a id=__codelineno-37-5 name=__codelineno-37-5 href=#__codelineno-37-5></a><span class=c1># Deploy the latest verion</span>
</span><span id=__span-37-6><a id=__codelineno-37-6 name=__codelineno-37-6 href=#__codelineno-37-6></a><span class=nt>image</span><span class=p>:</span>
</span><span id=__span-37-7><a id=__codelineno-37-7 name=__codelineno-37-7 href=#__codelineno-37-7></a><span class=w>  </span><span class=nt>tag</span><span class=p>:</span><span class=w> </span><span class=s>"19.0.1"</span>
</span><span id=__span-37-8><a id=__codelineno-37-8 name=__codelineno-37-8 href=#__codelineno-37-8></a>
</span><span id=__span-37-9><a id=__codelineno-37-9 name=__codelineno-37-9 href=#__codelineno-37-9></a><span class=c1># start: create OpenShift realm which is required by EDP</span>
</span><span id=__span-37-10><a id=__codelineno-37-10 name=__codelineno-37-10 href=#__codelineno-37-10></a><span class=nt>extraInitContainers</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
</span><span id=__span-37-11><a id=__codelineno-37-11 name=__codelineno-37-11 href=#__codelineno-37-11></a><span class=w>  </span><span class=no>- name: realm-provider</span>
</span><span id=__span-37-12><a id=__codelineno-37-12 name=__codelineno-37-12 href=#__codelineno-37-12></a><span class=w>    </span><span class=no>image: busybox</span>
</span><span id=__span-37-13><a id=__codelineno-37-13 name=__codelineno-37-13 href=#__codelineno-37-13></a><span class=w>    </span><span class=no>imagePullPolicy: IfNotPresent</span>
</span><span id=__span-37-14><a id=__codelineno-37-14 name=__codelineno-37-14 href=#__codelineno-37-14></a><span class=w>    </span><span class=no>command:</span>
</span><span id=__span-37-15><a id=__codelineno-37-15 name=__codelineno-37-15 href=#__codelineno-37-15></a><span class=w>      </span><span class=no>- sh</span>
</span><span id=__span-37-16><a id=__codelineno-37-16 name=__codelineno-37-16 href=#__codelineno-37-16></a><span class=w>    </span><span class=no>args:</span>
</span><span id=__span-37-17><a id=__codelineno-37-17 name=__codelineno-37-17 href=#__codelineno-37-17></a><span class=w>      </span><span class=no>- -c</span>
</span><span id=__span-37-18><a id=__codelineno-37-18 name=__codelineno-37-18 href=#__codelineno-37-18></a><span class=w>      </span><span class=no>- |</span>
</span><span id=__span-37-19><a id=__codelineno-37-19 name=__codelineno-37-19 href=#__codelineno-37-19></a><span class=w>        </span><span class=no>echo '{"realm": "openshift","enabled": true}' &gt; /opt/keycloak/data/import/openshift.json</span>
</span><span id=__span-37-20><a id=__codelineno-37-20 name=__codelineno-37-20 href=#__codelineno-37-20></a><span class=w>    </span><span class=no>volumeMounts:</span>
</span><span id=__span-37-21><a id=__codelineno-37-21 name=__codelineno-37-21 href=#__codelineno-37-21></a><span class=w>      </span><span class=no>- name: realm</span>
</span><span id=__span-37-22><a id=__codelineno-37-22 name=__codelineno-37-22 href=#__codelineno-37-22></a><span class=w>        </span><span class=no>mountPath: /opt/keycloak/data/import</span>
</span><span id=__span-37-23><a id=__codelineno-37-23 name=__codelineno-37-23 href=#__codelineno-37-23></a>
</span><span id=__span-37-24><a id=__codelineno-37-24 name=__codelineno-37-24 href=#__codelineno-37-24></a><span class=nt>extraVolumeMounts</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
</span><span id=__span-37-25><a id=__codelineno-37-25 name=__codelineno-37-25 href=#__codelineno-37-25></a><span class=w>  </span><span class=no>- name: realm</span>
</span><span id=__span-37-26><a id=__codelineno-37-26 name=__codelineno-37-26 href=#__codelineno-37-26></a><span class=w>    </span><span class=no>mountPath: /opt/keycloak/data/import</span>
</span><span id=__span-37-27><a id=__codelineno-37-27 name=__codelineno-37-27 href=#__codelineno-37-27></a>
</span><span id=__span-37-28><a id=__codelineno-37-28 name=__codelineno-37-28 href=#__codelineno-37-28></a><span class=nt>extraVolumes</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
</span><span id=__span-37-29><a id=__codelineno-37-29 name=__codelineno-37-29 href=#__codelineno-37-29></a><span class=w>  </span><span class=no>- name: realm</span>
</span><span id=__span-37-30><a id=__codelineno-37-30 name=__codelineno-37-30 href=#__codelineno-37-30></a><span class=w>    </span><span class=no>emptyDir: {}</span>
</span><span id=__span-37-31><a id=__codelineno-37-31 name=__codelineno-37-31 href=#__codelineno-37-31></a>
</span><span id=__span-37-32><a id=__codelineno-37-32 name=__codelineno-37-32 href=#__codelineno-37-32></a><span class=nt>command</span><span class=p>:</span>
</span><span id=__span-37-33><a id=__codelineno-37-33 name=__codelineno-37-33 href=#__codelineno-37-33></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>"/opt/keycloak/bin/kc.sh"</span>
</span><span id=__span-37-34><a id=__codelineno-37-34 name=__codelineno-37-34 href=#__codelineno-37-34></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>"--verbose"</span>
</span><span id=__span-37-35><a id=__codelineno-37-35 name=__codelineno-37-35 href=#__codelineno-37-35></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>"start"</span>
</span><span id=__span-37-36><a id=__codelineno-37-36 name=__codelineno-37-36 href=#__codelineno-37-36></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>"--http-enabled=true"</span>
</span><span id=__span-37-37><a id=__codelineno-37-37 name=__codelineno-37-37 href=#__codelineno-37-37></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>"--http-port=8080"</span>
</span><span id=__span-37-38><a id=__codelineno-37-38 name=__codelineno-37-38 href=#__codelineno-37-38></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>"--hostname-strict=false"</span>
</span><span id=__span-37-39><a id=__codelineno-37-39 name=__codelineno-37-39 href=#__codelineno-37-39></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>"--hostname-strict-https=false"</span>
</span><span id=__span-37-40><a id=__codelineno-37-40 name=__codelineno-37-40 href=#__codelineno-37-40></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>"--spi-events-listener-jboss-logging-success-level=info"</span>
</span><span id=__span-37-41><a id=__codelineno-37-41 name=__codelineno-37-41 href=#__codelineno-37-41></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>"--spi-events-listener-jboss-logging-error-level=warn"</span>
</span><span id=__span-37-42><a id=__codelineno-37-42 name=__codelineno-37-42 href=#__codelineno-37-42></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>"--import-realm"</span>
</span><span id=__span-37-43><a id=__codelineno-37-43 name=__codelineno-37-43 href=#__codelineno-37-43></a>
</span><span id=__span-37-44><a id=__codelineno-37-44 name=__codelineno-37-44 href=#__codelineno-37-44></a><span class=nt>extraEnv</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
</span><span id=__span-37-45><a id=__codelineno-37-45 name=__codelineno-37-45 href=#__codelineno-37-45></a><span class=w>  </span><span class=no>- name: KC_PROXY</span>
</span><span id=__span-37-46><a id=__codelineno-37-46 name=__codelineno-37-46 href=#__codelineno-37-46></a><span class=w>    </span><span class=no>value: "passthrough"</span>
</span><span id=__span-37-47><a id=__codelineno-37-47 name=__codelineno-37-47 href=#__codelineno-37-47></a><span class=w>  </span><span class=no>- name: KEYCLOAK_ADMIN</span>
</span><span id=__span-37-48><a id=__codelineno-37-48 name=__codelineno-37-48 href=#__codelineno-37-48></a><span class=w>    </span><span class=no>valueFrom:</span>
</span><span id=__span-37-49><a id=__codelineno-37-49 name=__codelineno-37-49 href=#__codelineno-37-49></a><span class=w>      </span><span class=no>secretKeyRef:</span>
</span><span id=__span-37-50><a id=__codelineno-37-50 name=__codelineno-37-50 href=#__codelineno-37-50></a><span class=w>        </span><span class=no>name: keycloak-admin-creds</span>
</span><span id=__span-37-51><a id=__codelineno-37-51 name=__codelineno-37-51 href=#__codelineno-37-51></a><span class=w>        </span><span class=no>key: username</span>
</span><span id=__span-37-52><a id=__codelineno-37-52 name=__codelineno-37-52 href=#__codelineno-37-52></a><span class=w>  </span><span class=no>- name: KEYCLOAK_ADMIN_PASSWORD</span>
</span><span id=__span-37-53><a id=__codelineno-37-53 name=__codelineno-37-53 href=#__codelineno-37-53></a><span class=w>    </span><span class=no>valueFrom:</span>
</span><span id=__span-37-54><a id=__codelineno-37-54 name=__codelineno-37-54 href=#__codelineno-37-54></a><span class=w>      </span><span class=no>secretKeyRef:</span>
</span><span id=__span-37-55><a id=__codelineno-37-55 name=__codelineno-37-55 href=#__codelineno-37-55></a><span class=w>        </span><span class=no>name: keycloak-admin-creds</span>
</span><span id=__span-37-56><a id=__codelineno-37-56 name=__codelineno-37-56 href=#__codelineno-37-56></a><span class=w>        </span><span class=no>key: password</span>
</span><span id=__span-37-57><a id=__codelineno-37-57 name=__codelineno-37-57 href=#__codelineno-37-57></a><span class=w>  </span><span class=no>- name: JAVA_OPTS_APPEND</span>
</span><span id=__span-37-58><a id=__codelineno-37-58 name=__codelineno-37-58 href=#__codelineno-37-58></a><span class=w>    </span><span class=no>value: &gt;-</span>
</span><span id=__span-37-59><a id=__codelineno-37-59 name=__codelineno-37-59 href=#__codelineno-37-59></a><span class=w>      </span><span class=no>-XX:+UseContainerSupport</span>
</span><span id=__span-37-60><a id=__codelineno-37-60 name=__codelineno-37-60 href=#__codelineno-37-60></a><span class=w>      </span><span class=no>-XX:MaxRAMPercentage=50.0</span>
</span><span id=__span-37-61><a id=__codelineno-37-61 name=__codelineno-37-61 href=#__codelineno-37-61></a><span class=w>      </span><span class=no>-Djava.awt.headless=true</span>
</span><span id=__span-37-62><a id=__codelineno-37-62 name=__codelineno-37-62 href=#__codelineno-37-62></a><span class=w>      </span><span class=no>-Djgroups.dns.query={{ include "keycloak.fullname" . }}-headless</span>
</span><span id=__span-37-63><a id=__codelineno-37-63 name=__codelineno-37-63 href=#__codelineno-37-63></a>
</span><span id=__span-37-64><a id=__codelineno-37-64 name=__codelineno-37-64 href=#__codelineno-37-64></a><span class=c1># This block should be uncommented if you install Keycloak on Kubernetes</span>
</span><span id=__span-37-65><a id=__codelineno-37-65 name=__codelineno-37-65 href=#__codelineno-37-65></a><span class=nt>ingress</span><span class=p>:</span>
</span><span id=__span-37-66><a id=__codelineno-37-66 name=__codelineno-37-66 href=#__codelineno-37-66></a><span class=w>  </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-37-67><a id=__codelineno-37-67 name=__codelineno-37-67 href=#__codelineno-37-67></a><span class=w>  </span><span class=nt>annotations</span><span class=p>:</span>
</span><span id=__span-37-68><a id=__codelineno-37-68 name=__codelineno-37-68 href=#__codelineno-37-68></a><span class=w>    </span><span class=nt>kubernetes.io/ingress.class</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
</span><span id=__span-37-69><a id=__codelineno-37-69 name=__codelineno-37-69 href=#__codelineno-37-69></a><span class=w>    </span><span class=nt>ingress.kubernetes.io/affinity</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">cookie</span>
</span><span id=__span-37-70><a id=__codelineno-37-70 name=__codelineno-37-70 href=#__codelineno-37-70></a><span class=w>  </span><span class=nt>rules</span><span class=p>:</span>
</span><span id=__span-37-71><a id=__codelineno-37-71 name=__codelineno-37-71 href=#__codelineno-37-71></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>host</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">keycloak.&lt;ROOT_DOMAIN&gt;</span>
</span><span id=__span-37-72><a id=__codelineno-37-72 name=__codelineno-37-72 href=#__codelineno-37-72></a><span class=w>      </span><span class=nt>paths</span><span class=p>:</span>
</span><span id=__span-37-73><a id=__codelineno-37-73 name=__codelineno-37-73 href=#__codelineno-37-73></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=s>'{{</span><span class=nv> </span><span class=s>tpl</span><span class=nv> </span><span class=s>.Values.http.relativePath</span><span class=nv> </span><span class=s>$</span><span class=nv> </span><span class=s>|</span><span class=nv> </span><span class=s>trimSuffix</span><span class=nv> </span><span class=s>"/"</span><span class=nv> </span><span class=s>}}/'</span>
</span><span id=__span-37-74><a id=__codelineno-37-74 name=__codelineno-37-74 href=#__codelineno-37-74></a><span class=w>          </span><span class=nt>pathType</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Prefix</span>
</span><span id=__span-37-75><a id=__codelineno-37-75 name=__codelineno-37-75 href=#__codelineno-37-75></a>
</span><span id=__span-37-76><a id=__codelineno-37-76 name=__codelineno-37-76 href=#__codelineno-37-76></a><span class=c1># This block should be uncommented if you set Keycloak to OpenShift and change the host field</span>
</span><span id=__span-37-77><a id=__codelineno-37-77 name=__codelineno-37-77 href=#__codelineno-37-77></a><span class=c1># route:</span>
</span><span id=__span-37-78><a id=__codelineno-37-78 name=__codelineno-37-78 href=#__codelineno-37-78></a><span class=c1>#   enabled: false</span>
</span><span id=__span-37-79><a id=__codelineno-37-79 name=__codelineno-37-79 href=#__codelineno-37-79></a><span class=c1>#   # Path for the Route</span>
</span><span id=__span-37-80><a id=__codelineno-37-80 name=__codelineno-37-80 href=#__codelineno-37-80></a><span class=c1>#   path: '/'</span>
</span><span id=__span-37-81><a id=__codelineno-37-81 name=__codelineno-37-81 href=#__codelineno-37-81></a><span class=c1>#   # Host name for the Route</span>
</span><span id=__span-37-82><a id=__codelineno-37-82 name=__codelineno-37-82 href=#__codelineno-37-82></a><span class=c1>#   host: "keycloak.&lt;ROOT_DOMAIN&gt;"</span>
</span><span id=__span-37-83><a id=__codelineno-37-83 name=__codelineno-37-83 href=#__codelineno-37-83></a><span class=c1>#   # TLS configuration</span>
</span><span id=__span-37-84><a id=__codelineno-37-84 name=__codelineno-37-84 href=#__codelineno-37-84></a><span class=c1>#   tls:</span>
</span><span id=__span-37-85><a id=__codelineno-37-85 name=__codelineno-37-85 href=#__codelineno-37-85></a><span class=c1>#     enabled: true</span>
</span><span id=__span-37-86><a id=__codelineno-37-86 name=__codelineno-37-86 href=#__codelineno-37-86></a>
</span><span id=__span-37-87><a id=__codelineno-37-87 name=__codelineno-37-87 href=#__codelineno-37-87></a><span class=nt>resources</span><span class=p>:</span>
</span><span id=__span-37-88><a id=__codelineno-37-88 name=__codelineno-37-88 href=#__codelineno-37-88></a><span class=w>  </span><span class=nt>limits</span><span class=p>:</span>
</span><span id=__span-37-89><a id=__codelineno-37-89 name=__codelineno-37-89 href=#__codelineno-37-89></a><span class=w>    </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s>"2048Mi"</span>
</span><span id=__span-37-90><a id=__codelineno-37-90 name=__codelineno-37-90 href=#__codelineno-37-90></a><span class=w>  </span><span class=nt>requests</span><span class=p>:</span>
</span><span id=__span-37-91><a id=__codelineno-37-91 name=__codelineno-37-91 href=#__codelineno-37-91></a><span class=w>    </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s>"50m"</span>
</span><span id=__span-37-92><a id=__codelineno-37-92 name=__codelineno-37-92 href=#__codelineno-37-92></a><span class=w>    </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s>"512Mi"</span>
</span><span id=__span-37-93><a id=__codelineno-37-93 name=__codelineno-37-93 href=#__codelineno-37-93></a>
</span><span id=__span-37-94><a id=__codelineno-37-94 name=__codelineno-37-94 href=#__codelineno-37-94></a><span class=c1># Check database readiness at startup</span>
</span><span id=__span-37-95><a id=__codelineno-37-95 name=__codelineno-37-95 href=#__codelineno-37-95></a><span class=nt>dbchecker</span><span class=p>:</span>
</span><span id=__span-37-96><a id=__codelineno-37-96 name=__codelineno-37-96 href=#__codelineno-37-96></a><span class=w>  </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-37-97><a id=__codelineno-37-97 name=__codelineno-37-97 href=#__codelineno-37-97></a>
</span><span id=__span-37-98><a id=__codelineno-37-98 name=__codelineno-37-98 href=#__codelineno-37-98></a><span class=nt>database</span><span class=p>:</span>
</span><span id=__span-37-99><a id=__codelineno-37-99 name=__codelineno-37-99 href=#__codelineno-37-99></a><span class=w>  </span><span class=nt>vendor</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">postgres</span>
</span><span id=__span-37-100><a id=__codelineno-37-100 name=__codelineno-37-100 href=#__codelineno-37-100></a><span class=w>  </span><span class=nt>existingSecret</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">keycloak-postgresql</span>
</span><span id=__span-37-101><a id=__codelineno-37-101 name=__codelineno-37-101 href=#__codelineno-37-101></a><span class=w>  </span><span class=nt>hostname</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">keycloak-postgresql</span>
</span><span id=__span-37-102><a id=__codelineno-37-102 name=__codelineno-37-102 href=#__codelineno-37-102></a><span class=w>  </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5432</span>
</span><span id=__span-37-103><a id=__codelineno-37-103 name=__codelineno-37-103 href=#__codelineno-37-103></a><span class=w>  </span><span class=nt>username</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">admin</span>
</span><span id=__span-37-104><a id=__codelineno-37-104 name=__codelineno-37-104 href=#__codelineno-37-104></a><span class=w>  </span><span class=nt>database</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">keycloak</span>
</span></code></pre></div> </details> </li> <li> <p>Deploy Keycloak:</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Change the namespace and the values file name if required.</p> </div> <div class="language-bash highlight"><pre><span></span><code><span id=__span-38-1><a id=__codelineno-38-1 name=__codelineno-38-1 href=#__codelineno-38-1></a>helm<span class=w> </span>install<span class=w> </span>keycloak<span class=w> </span>codecentric/keycloakx<span class=w> </span>--version<span class=w> </span><span class=m>1</span>.6.0<span class=w> </span>--values<span class=w> </span>keycloak-values.yaml<span class=w> </span>-n<span class=w> </span>security
</span></code></pre></div> </li> <li> <p>Log in to Keycloak and check if everything has been imported correctly.</p> </li> </ol> <h3 id=clean-and-analyze-database_1>Clean and Analyze Database<a class=headerlink href=#clean-and-analyze-database_1 title="Permanent link">âš“ï¸Ž</a></h3> <p>Optionally, run the <a href=https://www.postgresql.org/docs/current/app-vacuumdb.html>vacuumdb</a> application on the database, to analyze the contents of database tables and collect statistics for the Postgres query optimizer:</p> <p></p><div class="language-bash highlight"><pre><span></span><code><span id=__span-39-1><a id=__codelineno-39-1 name=__codelineno-39-1 href=#__codelineno-39-1></a><span class=nv>PGPASSWORD</span><span class=o>=</span><span class=s2>"</span><span class=si>${</span><span class=nv>postgresql_postgres</span><span class=p>-password</span><span class=si>}</span><span class=s2>"</span><span class=w> </span>vacuumdb<span class=w> </span>--analyze<span class=w> </span>--verbose<span class=w> </span>-d<span class=w> </span>keycloak<span class=w> </span>-U<span class=w> </span>postgres
</span></code></pre></div> For all databases, run the following command: <div class="language-bash highlight"><pre><span></span><code><span id=__span-40-1><a id=__codelineno-40-1 name=__codelineno-40-1 href=#__codelineno-40-1></a><span class=nv>PGPASSWORD</span><span class=o>=</span><span class=s2>"</span><span class=si>${</span><span class=nv>postgresql_postgres</span><span class=p>-password</span><span class=si>}</span><span class=s2>"</span><span class=w> </span>vacuumdb<span class=w> </span>--analyze<span class=w> </span>--verbose<span class=w> </span>--all<span class=w> </span>-U<span class=w> </span>postgres
</span></code></pre></div> <h3 id=postgres-database-migration-script>Postgres Database Migration Script<a name=Pdms></a><a class=headerlink href=#postgres-database-migration-script title="Permanent link">âš“ï¸Ž</a></h3> <div class="admonition info"> <p class=admonition-title>Info</p> <p>Please read the <a href=#KPM>Migrate Postgres Database From Postgres v.11.x to v.14.5</a> section of this tutorial before using the script.</p> </div> <div class="admonition note"> <p class=admonition-title>Note</p> <ul> <li>The <a href=https://github.com/kubernetes/kubectl><code>kubectl</code></a> tool is required for using this script.</li> <li>This script will likely work for any other Postgres database besides Keycloak after some adjustments. It queries the <code>pg_dump</code>, <code>pg_dumpall</code>, <code>psql</code>, and <code>vacuumdb</code> commands under the hood.</li> </ul> </div> <p>The following script can be used for exporting and importing Postgres databases as well as optimizing them with the <a href=https://www.postgresql.org/docs/current/app-vacuumdb.html>vacuumdb</a> application. Please examine the code and make the adjustments if required.</p> <ul> <li> <p>By default, the following command exports Keycloak Postgres databases from a Kubernetes pod to a local machine:</p> <div class=codehilite><pre><span></span><code>./script.sh
</code></pre></div> <p>After running the command, please follow the prompt.</p> </li> </ul> <ul> <li>To import a database backup to a newly created Postgres Kubernetes pod, pass a database dump sql file to the script:<div class=codehilite><pre><span></span><code>./script.sh path-to/db_dump.sql
</code></pre></div> </li> </ul> <ul> <li>The <code>-h</code> flag prints help, and <code>-c|-v</code> runs the <code>vacuumdb</code> garbage collector and analyzer.</li> </ul> <details> <summary><b>View: keycloak_db_migration.sh</b></summary> <div class="language-bash highlight"><pre><span></span><code><span id=__span-41-1><a id=__codelineno-41-1 name=__codelineno-41-1 href=#__codelineno-41-1></a><span class=ch>#!/bin/bash</span>
</span><span id=__span-41-2><a id=__codelineno-41-2 name=__codelineno-41-2 href=#__codelineno-41-2></a>
</span><span id=__span-41-3><a id=__codelineno-41-3 name=__codelineno-41-3 href=#__codelineno-41-3></a><span class=c1># set -x</span>
</span><span id=__span-41-4><a id=__codelineno-41-4 name=__codelineno-41-4 href=#__codelineno-41-4></a>
</span><span id=__span-41-5><a id=__codelineno-41-5 name=__codelineno-41-5 href=#__codelineno-41-5></a>db_migration_help<span class=o>(){</span>
</span><span id=__span-41-6><a id=__codelineno-41-6 name=__codelineno-41-6 href=#__codelineno-41-6></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>"Keycloak Postgres database migration"</span>
</span><span id=__span-41-7><a id=__codelineno-41-7 name=__codelineno-41-7 href=#__codelineno-41-7></a><span class=w>    </span><span class=nb>echo</span>
</span><span id=__span-41-8><a id=__codelineno-41-8 name=__codelineno-41-8 href=#__codelineno-41-8></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>"Usage:"</span>
</span><span id=__span-41-9><a id=__codelineno-41-9 name=__codelineno-41-9 href=#__codelineno-41-9></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>"------------------------------------------"</span>
</span><span id=__span-41-10><a id=__codelineno-41-10 name=__codelineno-41-10 href=#__codelineno-41-10></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>"Export Keycloak Postgres database from pod"</span>
</span><span id=__span-41-11><a id=__codelineno-41-11 name=__codelineno-41-11 href=#__codelineno-41-11></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>"Run without parameters:"</span>
</span><span id=__span-41-12><a id=__codelineno-41-12 name=__codelineno-41-12 href=#__codelineno-41-12></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>"      </span><span class=nv>$0</span><span class=s2>"</span>
</span><span id=__span-41-13><a id=__codelineno-41-13 name=__codelineno-41-13 href=#__codelineno-41-13></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>"------------------------------------------"</span>
</span><span id=__span-41-14><a id=__codelineno-41-14 name=__codelineno-41-14 href=#__codelineno-41-14></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>"Import Keycloak Postgres database to pod"</span>
</span><span id=__span-41-15><a id=__codelineno-41-15 name=__codelineno-41-15 href=#__codelineno-41-15></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>"Pass filename to script:"</span>
</span><span id=__span-41-16><a id=__codelineno-41-16 name=__codelineno-41-16 href=#__codelineno-41-16></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>"      </span><span class=nv>$0</span><span class=s2> path/to/db_dump.sql"</span>
</span><span id=__span-41-17><a id=__codelineno-41-17 name=__codelineno-41-17 href=#__codelineno-41-17></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>"------------------------------------------"</span>
</span><span id=__span-41-18><a id=__codelineno-41-18 name=__codelineno-41-18 href=#__codelineno-41-18></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>"Additional options: "</span>
</span><span id=__span-41-19><a id=__codelineno-41-19 name=__codelineno-41-19 href=#__codelineno-41-19></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>"      </span><span class=nv>$0</span><span class=s2> [OPTIONS...]"</span>
</span><span id=__span-41-20><a id=__codelineno-41-20 name=__codelineno-41-20 href=#__codelineno-41-20></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>"Options:"</span>
</span><span id=__span-41-21><a id=__codelineno-41-21 name=__codelineno-41-21 href=#__codelineno-41-21></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>"h     Print Help."</span>
</span><span id=__span-41-22><a id=__codelineno-41-22 name=__codelineno-41-22 href=#__codelineno-41-22></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>"c|v   Run garbage collector and analyzer."</span>
</span><span id=__span-41-23><a id=__codelineno-41-23 name=__codelineno-41-23 href=#__codelineno-41-23></a><span class=o>}</span>
</span><span id=__span-41-24><a id=__codelineno-41-24 name=__codelineno-41-24 href=#__codelineno-41-24></a>
</span><span id=__span-41-25><a id=__codelineno-41-25 name=__codelineno-41-25 href=#__codelineno-41-25></a>keycloak_ns<span class=o>(){</span>
</span><span id=__span-41-26><a id=__codelineno-41-26 name=__codelineno-41-26 href=#__codelineno-41-26></a><span class=w>    </span><span class=nb>printf</span><span class=w> </span><span class=s1>'%s\n'</span><span class=w> </span><span class=s1>'Enter keycloak namespace: '</span>
</span><span id=__span-41-27><a id=__codelineno-41-27 name=__codelineno-41-27 href=#__codelineno-41-27></a><span class=w>    </span><span class=nb>read</span><span class=w> </span>-r<span class=w> </span>keycloak_namespace
</span><span id=__span-41-28><a id=__codelineno-41-28 name=__codelineno-41-28 href=#__codelineno-41-28></a>
</span><span id=__span-41-29><a id=__codelineno-41-29 name=__codelineno-41-29 href=#__codelineno-41-29></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=s2>"</span><span class=si>${</span><span class=nv>keycloak_namespace</span><span class=si>}</span><span class=s2>"</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
</span><span id=__span-41-30><a id=__codelineno-41-30 name=__codelineno-41-30 href=#__codelineno-41-30></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>"Don't skip namespace"</span>
</span><span id=__span-41-31><a id=__codelineno-41-31 name=__codelineno-41-31 href=#__codelineno-41-31></a><span class=w>        </span><span class=nb>exit</span><span class=w> </span><span class=m>1</span>
</span><span id=__span-41-32><a id=__codelineno-41-32 name=__codelineno-41-32 href=#__codelineno-41-32></a><span class=w>    </span><span class=k>fi</span>
</span><span id=__span-41-33><a id=__codelineno-41-33 name=__codelineno-41-33 href=#__codelineno-41-33></a><span class=o>}</span>
</span><span id=__span-41-34><a id=__codelineno-41-34 name=__codelineno-41-34 href=#__codelineno-41-34></a>
</span><span id=__span-41-35><a id=__codelineno-41-35 name=__codelineno-41-35 href=#__codelineno-41-35></a>postgres_pod<span class=o>(){</span>
</span><span id=__span-41-36><a id=__codelineno-41-36 name=__codelineno-41-36 href=#__codelineno-41-36></a><span class=w>    </span><span class=nb>printf</span><span class=w> </span><span class=s1>'%s\n'</span><span class=w> </span><span class=s1>'Enter postgres pod name: '</span>
</span><span id=__span-41-37><a id=__codelineno-41-37 name=__codelineno-41-37 href=#__codelineno-41-37></a><span class=w>    </span><span class=nb>read</span><span class=w> </span>-r<span class=w> </span>postgres_pod_name
</span><span id=__span-41-38><a id=__codelineno-41-38 name=__codelineno-41-38 href=#__codelineno-41-38></a>
</span><span id=__span-41-39><a id=__codelineno-41-39 name=__codelineno-41-39 href=#__codelineno-41-39></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=s2>"</span><span class=si>${</span><span class=nv>postgres_pod_name</span><span class=si>}</span><span class=s2>"</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
</span><span id=__span-41-40><a id=__codelineno-41-40 name=__codelineno-41-40 href=#__codelineno-41-40></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>"Don't skip pod name"</span>
</span><span id=__span-41-41><a id=__codelineno-41-41 name=__codelineno-41-41 href=#__codelineno-41-41></a><span class=w>        </span><span class=nb>exit</span><span class=w> </span><span class=m>1</span>
</span><span id=__span-41-42><a id=__codelineno-41-42 name=__codelineno-41-42 href=#__codelineno-41-42></a><span class=w>    </span><span class=k>fi</span>
</span><span id=__span-41-43><a id=__codelineno-41-43 name=__codelineno-41-43 href=#__codelineno-41-43></a><span class=o>}</span>
</span><span id=__span-41-44><a id=__codelineno-41-44 name=__codelineno-41-44 href=#__codelineno-41-44></a>
</span><span id=__span-41-45><a id=__codelineno-41-45 name=__codelineno-41-45 href=#__codelineno-41-45></a>postgres_user<span class=o>(){</span>
</span><span id=__span-41-46><a id=__codelineno-41-46 name=__codelineno-41-46 href=#__codelineno-41-46></a><span class=w>    </span><span class=nb>printf</span><span class=w> </span><span class=s1>'%s\n'</span><span class=w> </span><span class=s1>'Enter postgres username: '</span>
</span><span id=__span-41-47><a id=__codelineno-41-47 name=__codelineno-41-47 href=#__codelineno-41-47></a><span class=w>    </span><span class=nb>printf</span><span class=w> </span><span class=s1>'%s'</span><span class=w> </span><span class=s2>"Skip to use [postgres] superuser: "</span>
</span><span id=__span-41-48><a id=__codelineno-41-48 name=__codelineno-41-48 href=#__codelineno-41-48></a><span class=w>    </span><span class=nb>read</span><span class=w> </span>-r<span class=w> </span>postgres_username
</span><span id=__span-41-49><a id=__codelineno-41-49 name=__codelineno-41-49 href=#__codelineno-41-49></a>
</span><span id=__span-41-50><a id=__codelineno-41-50 name=__codelineno-41-50 href=#__codelineno-41-50></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=s2>"</span><span class=si>${</span><span class=nv>postgres_username</span><span class=si>}</span><span class=s2>"</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
</span><span id=__span-41-51><a id=__codelineno-41-51 name=__codelineno-41-51 href=#__codelineno-41-51></a><span class=w>        </span><span class=nv>postgres_username</span><span class=o>=</span><span class=s1>'postgres'</span>
</span><span id=__span-41-52><a id=__codelineno-41-52 name=__codelineno-41-52 href=#__codelineno-41-52></a><span class=w>    </span><span class=k>fi</span>
</span><span id=__span-41-53><a id=__codelineno-41-53 name=__codelineno-41-53 href=#__codelineno-41-53></a><span class=o>}</span>
</span><span id=__span-41-54><a id=__codelineno-41-54 name=__codelineno-41-54 href=#__codelineno-41-54></a>
</span><span id=__span-41-55><a id=__codelineno-41-55 name=__codelineno-41-55 href=#__codelineno-41-55></a>pgdb_host_info<span class=o>(){</span>
</span><span id=__span-41-56><a id=__codelineno-41-56 name=__codelineno-41-56 href=#__codelineno-41-56></a><span class=w>    </span><span class=nv>database_name</span><span class=o>=</span><span class=s1>'keycloak'</span>
</span><span id=__span-41-57><a id=__codelineno-41-57 name=__codelineno-41-57 href=#__codelineno-41-57></a><span class=w>    </span><span class=nv>db_host</span><span class=o>=</span><span class=s1>'localhost'</span>
</span><span id=__span-41-58><a id=__codelineno-41-58 name=__codelineno-41-58 href=#__codelineno-41-58></a><span class=w>    </span><span class=nv>db_port</span><span class=o>=</span><span class=s1>'5432'</span>
</span><span id=__span-41-59><a id=__codelineno-41-59 name=__codelineno-41-59 href=#__codelineno-41-59></a><span class=o>}</span>
</span><span id=__span-41-60><a id=__codelineno-41-60 name=__codelineno-41-60 href=#__codelineno-41-60></a>
</span><span id=__span-41-61><a id=__codelineno-41-61 name=__codelineno-41-61 href=#__codelineno-41-61></a>postgresql_admin_pass<span class=o>(){</span>
</span><span id=__span-41-62><a id=__codelineno-41-62 name=__codelineno-41-62 href=#__codelineno-41-62></a><span class=w>    </span><span class=nv>postgresql_password</span><span class=o>=</span><span class=s1>'POSTGRES_PASSWORD'</span>
</span><span id=__span-41-63><a id=__codelineno-41-63 name=__codelineno-41-63 href=#__codelineno-41-63></a><span class=w>    </span><span class=nv>postgresql_admin_password</span><span class=o>=</span><span class=s2>"</span><span class=k>$(</span>kubectl<span class=w> </span><span class=nb>exec</span><span class=w> </span>-n<span class=w> </span><span class=s2>"</span><span class=si>${</span><span class=nv>keycloak_namespace</span><span class=si>}</span><span class=s2>"</span><span class=w> </span><span class=s2>"</span><span class=si>${</span><span class=nv>postgres_pod_name</span><span class=si>}</span><span class=s2>"</span><span class=w> </span><span class=s2>"--"</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-41-64><a id=__codelineno-41-64 name=__codelineno-41-64 href=#__codelineno-41-64></a><span class=w>        </span>sh<span class=w> </span>-c<span class=w> </span><span class=s2>"printenv </span><span class=si>${</span><span class=nv>postgresql_password</span><span class=si>}</span><span class=s2>"</span><span class=k>)</span><span class=s2>"</span>
</span><span id=__span-41-65><a id=__codelineno-41-65 name=__codelineno-41-65 href=#__codelineno-41-65></a><span class=o>}</span>
</span><span id=__span-41-66><a id=__codelineno-41-66 name=__codelineno-41-66 href=#__codelineno-41-66></a>
</span><span id=__span-41-67><a id=__codelineno-41-67 name=__codelineno-41-67 href=#__codelineno-41-67></a>postgresql_su_pass<span class=o>(){</span>
</span><span id=__span-41-68><a id=__codelineno-41-68 name=__codelineno-41-68 href=#__codelineno-41-68></a><span class=w>    </span><span class=nv>postgresql_postgres_password</span><span class=o>=</span><span class=s1>'POSTGRES_POSTGRES_PASSWORD'</span>
</span><span id=__span-41-69><a id=__codelineno-41-69 name=__codelineno-41-69 href=#__codelineno-41-69></a><span class=w>    </span><span class=nv>postgresql_superuser_password</span><span class=o>=</span><span class=s2>"</span><span class=k>$(</span>kubectl<span class=w> </span><span class=nb>exec</span><span class=w> </span>-n<span class=w> </span><span class=s2>"</span><span class=si>${</span><span class=nv>keycloak_namespace</span><span class=si>}</span><span class=s2>"</span><span class=w> </span><span class=s2>"</span><span class=si>${</span><span class=nv>postgres_pod_name</span><span class=si>}</span><span class=s2>"</span><span class=w> </span><span class=s2>"--"</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-41-70><a id=__codelineno-41-70 name=__codelineno-41-70 href=#__codelineno-41-70></a><span class=w>        </span>sh<span class=w> </span>-c<span class=w> </span><span class=s2>"printenv </span><span class=si>${</span><span class=nv>postgresql_postgres_password</span><span class=si>}</span><span class=s2>"</span><span class=k>)</span><span class=s2>"</span>
</span><span id=__span-41-71><a id=__codelineno-41-71 name=__codelineno-41-71 href=#__codelineno-41-71></a>
</span><span id=__span-41-72><a id=__codelineno-41-72 name=__codelineno-41-72 href=#__codelineno-41-72></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-z<span class=w> </span><span class=s2>"</span><span class=si>${</span><span class=nv>postgresql_superuser_password</span><span class=si>}</span><span class=s2>"</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
</span><span id=__span-41-73><a id=__codelineno-41-73 name=__codelineno-41-73 href=#__codelineno-41-73></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>"SuperUser password variable does not exist. Using user password instead..."</span>
</span><span id=__span-41-74><a id=__codelineno-41-74 name=__codelineno-41-74 href=#__codelineno-41-74></a><span class=w>        </span>postgresql_admin_pass
</span><span id=__span-41-75><a id=__codelineno-41-75 name=__codelineno-41-75 href=#__codelineno-41-75></a><span class=w>        </span><span class=nv>postgresql_superuser_password</span><span class=o>=</span><span class=s2>"</span><span class=si>${</span><span class=nv>postgresql_admin_password</span><span class=si>}</span><span class=s2>"</span>
</span><span id=__span-41-76><a id=__codelineno-41-76 name=__codelineno-41-76 href=#__codelineno-41-76></a><span class=w>    </span><span class=k>fi</span>
</span><span id=__span-41-77><a id=__codelineno-41-77 name=__codelineno-41-77 href=#__codelineno-41-77></a><span class=o>}</span>
</span><span id=__span-41-78><a id=__codelineno-41-78 name=__codelineno-41-78 href=#__codelineno-41-78></a>
</span><span id=__span-41-79><a id=__codelineno-41-79 name=__codelineno-41-79 href=#__codelineno-41-79></a>keycloak_pgdb_export<span class=o>(){</span>
</span><span id=__span-41-80><a id=__codelineno-41-80 name=__codelineno-41-80 href=#__codelineno-41-80></a><span class=w>    </span><span class=nv>current_cluster</span><span class=o>=</span><span class=s2>"</span><span class=k>$(</span>kubectl<span class=w> </span>config<span class=w> </span>current-context<span class=w> </span><span class=p>|</span><span class=w> </span>tr<span class=w> </span>-dc<span class=w> </span><span class=s1>'[:alnum:]-'</span><span class=k>)</span><span class=s2>"</span>
</span><span id=__span-41-81><a id=__codelineno-41-81 name=__codelineno-41-81 href=#__codelineno-41-81></a><span class=w>    </span><span class=nv>exported_db_name</span><span class=o>=</span><span class=s2>"keycloak_db_dump_</span><span class=si>${</span><span class=nv>current_cluster</span><span class=si>}</span><span class=s2>_</span><span class=si>${</span><span class=nv>keycloak_namespace</span><span class=si>}</span><span class=s2>_</span><span class=si>${</span><span class=nv>postgres_username</span><span class=si>}</span><span class=s2>_</span><span class=k>$(</span>date<span class=w> </span>+<span class=s2>"%Y%m%d%H%M"</span><span class=k>)</span><span class=s2>.sql"</span>
</span><span id=__span-41-82><a id=__codelineno-41-82 name=__codelineno-41-82 href=#__codelineno-41-82></a>
</span><span id=__span-41-83><a id=__codelineno-41-83 name=__codelineno-41-83 href=#__codelineno-41-83></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>"</span><span class=si>${</span><span class=nv>postgres_username</span><span class=si>}</span><span class=s2>"</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s1>'postgres'</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
</span><span id=__span-41-84><a id=__codelineno-41-84 name=__codelineno-41-84 href=#__codelineno-41-84></a><span class=w>        </span><span class=c1># call a function to get a pass for postgres user</span>
</span><span id=__span-41-85><a id=__codelineno-41-85 name=__codelineno-41-85 href=#__codelineno-41-85></a><span class=w>        </span>postgresql_su_pass
</span><span id=__span-41-86><a id=__codelineno-41-86 name=__codelineno-41-86 href=#__codelineno-41-86></a><span class=w>        </span>kubectl<span class=w> </span><span class=nb>exec</span><span class=w> </span>-n<span class=w> </span><span class=s2>"</span><span class=si>${</span><span class=nv>keycloak_namespace</span><span class=si>}</span><span class=s2>"</span><span class=w> </span><span class=s2>"</span><span class=si>${</span><span class=nv>postgres_pod_name</span><span class=si>}</span><span class=s2>"</span><span class=w> </span><span class=s2>"--"</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-41-87><a id=__codelineno-41-87 name=__codelineno-41-87 href=#__codelineno-41-87></a><span class=w>            </span>sh<span class=w> </span>-c<span class=w> </span><span class=s2>"PGPASSWORD='"</span><span class=si>${</span><span class=nv>postgresql_superuser_password</span><span class=si>}</span><span class=s2>"' pg_dumpall -h "</span><span class=si>${</span><span class=nv>db_host</span><span class=si>}</span><span class=s2>" -p "</span><span class=si>${</span><span class=nv>db_port</span><span class=si>}</span><span class=s2>" -U "</span><span class=si>${</span><span class=nv>postgres_username</span><span class=si>}</span><span class=s2>""</span><span class=w> </span>&gt;<span class=w> </span><span class=s2>"</span><span class=si>${</span><span class=nv>exported_db_name</span><span class=si>}</span><span class=s2>"</span>
</span><span id=__span-41-88><a id=__codelineno-41-88 name=__codelineno-41-88 href=#__codelineno-41-88></a><span class=w>    </span><span class=k>else</span>
</span><span id=__span-41-89><a id=__codelineno-41-89 name=__codelineno-41-89 href=#__codelineno-41-89></a><span class=w>        </span><span class=c1># call a function to get a pass for admin user</span>
</span><span id=__span-41-90><a id=__codelineno-41-90 name=__codelineno-41-90 href=#__codelineno-41-90></a><span class=w>        </span>postgresql_admin_pass
</span><span id=__span-41-91><a id=__codelineno-41-91 name=__codelineno-41-91 href=#__codelineno-41-91></a><span class=w>        </span>kubectl<span class=w> </span><span class=nb>exec</span><span class=w> </span>-n<span class=w> </span><span class=s2>"</span><span class=si>${</span><span class=nv>keycloak_namespace</span><span class=si>}</span><span class=s2>"</span><span class=w> </span><span class=s2>"</span><span class=si>${</span><span class=nv>postgres_pod_name</span><span class=si>}</span><span class=s2>"</span><span class=w> </span><span class=s2>"--"</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-41-92><a id=__codelineno-41-92 name=__codelineno-41-92 href=#__codelineno-41-92></a><span class=w>            </span>sh<span class=w> </span>-c<span class=w> </span><span class=s2>"PGPASSWORD='"</span><span class=si>${</span><span class=nv>postgresql_admin_password</span><span class=si>}</span><span class=s2>"' pg_dump -h "</span><span class=si>${</span><span class=nv>db_host</span><span class=si>}</span><span class=s2>" -p "</span><span class=si>${</span><span class=nv>db_port</span><span class=si>}</span><span class=s2>" -U "</span><span class=si>${</span><span class=nv>postgres_username</span><span class=si>}</span><span class=s2>" -d "</span><span class=si>${</span><span class=nv>database_name</span><span class=si>}</span><span class=s2>""</span><span class=w> </span>&gt;<span class=w> </span><span class=s2>"</span><span class=si>${</span><span class=nv>exported_db_name</span><span class=si>}</span><span class=s2>"</span>
</span><span id=__span-41-93><a id=__codelineno-41-93 name=__codelineno-41-93 href=#__codelineno-41-93></a><span class=w>    </span><span class=k>fi</span>
</span><span id=__span-41-94><a id=__codelineno-41-94 name=__codelineno-41-94 href=#__codelineno-41-94></a>
</span><span id=__span-41-95><a id=__codelineno-41-95 name=__codelineno-41-95 href=#__codelineno-41-95></a><span class=w>    </span><span class=nv>separate_lines</span><span class=o>=</span><span class=s2>"---------------"</span>
</span><span id=__span-41-96><a id=__codelineno-41-96 name=__codelineno-41-96 href=#__codelineno-41-96></a>
</span><span id=__span-41-97><a id=__codelineno-41-97 name=__codelineno-41-97 href=#__codelineno-41-97></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>!<span class=w> </span>-s<span class=w> </span><span class=s2>"</span><span class=si>${</span><span class=nv>exported_db_name</span><span class=si>}</span><span class=s2>"</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
</span><span id=__span-41-98><a id=__codelineno-41-98 name=__codelineno-41-98 href=#__codelineno-41-98></a><span class=w>        </span>rm<span class=w> </span>-f<span class=w> </span><span class=s2>"</span><span class=si>${</span><span class=nv>exported_db_name</span><span class=si>}</span><span class=s2>"</span>
</span><span id=__span-41-99><a id=__codelineno-41-99 name=__codelineno-41-99 href=#__codelineno-41-99></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>"</span><span class=si>${</span><span class=nv>separate_lines</span><span class=si>}</span><span class=s2>"</span>
</span><span id=__span-41-100><a id=__codelineno-41-100 name=__codelineno-41-100 href=#__codelineno-41-100></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>"Something went wrong. The database dump file is empty and was not saved."</span>
</span><span id=__span-41-101><a id=__codelineno-41-101 name=__codelineno-41-101 href=#__codelineno-41-101></a><span class=w>    </span><span class=k>else</span>
</span><span id=__span-41-102><a id=__codelineno-41-102 name=__codelineno-41-102 href=#__codelineno-41-102></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>"</span><span class=si>${</span><span class=nv>separate_lines</span><span class=si>}</span><span class=s2>"</span>
</span><span id=__span-41-103><a id=__codelineno-41-103 name=__codelineno-41-103 href=#__codelineno-41-103></a><span class=w>        </span>grep<span class=w> </span><span class=s1>'Dumped'</span><span class=w> </span><span class=s2>"</span><span class=si>${</span><span class=nv>exported_db_name</span><span class=si>}</span><span class=s2>"</span><span class=w> </span><span class=p>|</span><span class=w> </span>sort<span class=w> </span>-u
</span><span id=__span-41-104><a id=__codelineno-41-104 name=__codelineno-41-104 href=#__codelineno-41-104></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>"Database has been exported to </span><span class=k>$(</span><span class=nb>pwd</span><span class=k>)</span><span class=s2>/</span><span class=si>${</span><span class=nv>exported_db_name</span><span class=si>}</span><span class=s2>"</span>
</span><span id=__span-41-105><a id=__codelineno-41-105 name=__codelineno-41-105 href=#__codelineno-41-105></a><span class=w>    </span><span class=k>fi</span>
</span><span id=__span-41-106><a id=__codelineno-41-106 name=__codelineno-41-106 href=#__codelineno-41-106></a><span class=o>}</span>
</span><span id=__span-41-107><a id=__codelineno-41-107 name=__codelineno-41-107 href=#__codelineno-41-107></a>
</span><span id=__span-41-108><a id=__codelineno-41-108 name=__codelineno-41-108 href=#__codelineno-41-108></a>keycloak_pgdb_import<span class=o>(){</span>
</span><span id=__span-41-109><a id=__codelineno-41-109 name=__codelineno-41-109 href=#__codelineno-41-109></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>"Preparing Import"</span>
</span><span id=__span-41-110><a id=__codelineno-41-110 name=__codelineno-41-110 href=#__codelineno-41-110></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>"----------------"</span>
</span><span id=__span-41-111><a id=__codelineno-41-111 name=__codelineno-41-111 href=#__codelineno-41-111></a>
</span><span id=__span-41-112><a id=__codelineno-41-112 name=__codelineno-41-112 href=#__codelineno-41-112></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>!<span class=w> </span>-f<span class=w> </span><span class=s2>"</span><span class=nv>$1</span><span class=s2>"</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
</span><span id=__span-41-113><a id=__codelineno-41-113 name=__codelineno-41-113 href=#__codelineno-41-113></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>"The file </span><span class=nv>$1</span><span class=s2> does not exist."</span>
</span><span id=__span-41-114><a id=__codelineno-41-114 name=__codelineno-41-114 href=#__codelineno-41-114></a><span class=w>        </span><span class=nb>exit</span><span class=w> </span><span class=m>1</span>
</span><span id=__span-41-115><a id=__codelineno-41-115 name=__codelineno-41-115 href=#__codelineno-41-115></a><span class=w>    </span><span class=k>fi</span>
</span><span id=__span-41-116><a id=__codelineno-41-116 name=__codelineno-41-116 href=#__codelineno-41-116></a>
</span><span id=__span-41-117><a id=__codelineno-41-117 name=__codelineno-41-117 href=#__codelineno-41-117></a><span class=w>    </span>keycloak_ns
</span><span id=__span-41-118><a id=__codelineno-41-118 name=__codelineno-41-118 href=#__codelineno-41-118></a><span class=w>    </span>postgres_pod
</span><span id=__span-41-119><a id=__codelineno-41-119 name=__codelineno-41-119 href=#__codelineno-41-119></a><span class=w>    </span>postgres_user
</span><span id=__span-41-120><a id=__codelineno-41-120 name=__codelineno-41-120 href=#__codelineno-41-120></a><span class=w>    </span>pgdb_host_info
</span><span id=__span-41-121><a id=__codelineno-41-121 name=__codelineno-41-121 href=#__codelineno-41-121></a>
</span><span id=__span-41-122><a id=__codelineno-41-122 name=__codelineno-41-122 href=#__codelineno-41-122></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>"</span><span class=si>${</span><span class=nv>postgres_username</span><span class=si>}</span><span class=s2>"</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s1>'postgres'</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
</span><span id=__span-41-123><a id=__codelineno-41-123 name=__codelineno-41-123 href=#__codelineno-41-123></a><span class=w>        </span><span class=c1># restore full backup with all databases and roles as superuser or a single database</span>
</span><span id=__span-41-124><a id=__codelineno-41-124 name=__codelineno-41-124 href=#__codelineno-41-124></a><span class=w>        </span>postgresql_su_pass
</span><span id=__span-41-125><a id=__codelineno-41-125 name=__codelineno-41-125 href=#__codelineno-41-125></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-n<span class=w> </span><span class=s2>"</span><span class=k>$(</span>cat<span class=w> </span><span class=s2>"</span><span class=nv>$1</span><span class=s2>"</span><span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span><span class=s1>'CREATE ROLE'</span><span class=k>)</span><span class=s2>"</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
</span><span id=__span-41-126><a id=__codelineno-41-126 name=__codelineno-41-126 href=#__codelineno-41-126></a><span class=w>            </span>cat<span class=w> </span><span class=s2>"</span><span class=nv>$1</span><span class=s2>"</span><span class=w> </span><span class=p>|</span><span class=w> </span>kubectl<span class=w> </span><span class=nb>exec</span><span class=w> </span>-i<span class=w> </span>-n<span class=w> </span><span class=s2>"</span><span class=si>${</span><span class=nv>keycloak_namespace</span><span class=si>}</span><span class=s2>"</span><span class=w> </span><span class=s2>"</span><span class=si>${</span><span class=nv>postgres_pod_name</span><span class=si>}</span><span class=s2>"</span><span class=w> </span><span class=s2>"--"</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-41-127><a id=__codelineno-41-127 name=__codelineno-41-127 href=#__codelineno-41-127></a><span class=w>                </span>sh<span class=w> </span>-c<span class=w> </span><span class=s2>"cat | PGPASSWORD='"</span><span class=si>${</span><span class=nv>postgresql_superuser_password</span><span class=si>}</span><span class=s2>"' psql -h "</span><span class=si>${</span><span class=nv>db_host</span><span class=si>}</span><span class=s2>" -p "</span><span class=si>${</span><span class=nv>db_port</span><span class=si>}</span><span class=s2>" -U "</span><span class=si>${</span><span class=nv>postgres_username</span><span class=si>}</span><span class=s2>""</span>
</span><span id=__span-41-128><a id=__codelineno-41-128 name=__codelineno-41-128 href=#__codelineno-41-128></a><span class=w>        </span><span class=k>else</span>
</span><span id=__span-41-129><a id=__codelineno-41-129 name=__codelineno-41-129 href=#__codelineno-41-129></a><span class=w>            </span>cat<span class=w> </span><span class=s2>"</span><span class=nv>$1</span><span class=s2>"</span><span class=w> </span><span class=p>|</span><span class=w> </span>kubectl<span class=w> </span><span class=nb>exec</span><span class=w> </span>-i<span class=w> </span>-n<span class=w> </span><span class=s2>"</span><span class=si>${</span><span class=nv>keycloak_namespace</span><span class=si>}</span><span class=s2>"</span><span class=w> </span><span class=s2>"</span><span class=si>${</span><span class=nv>postgres_pod_name</span><span class=si>}</span><span class=s2>"</span><span class=w> </span><span class=s2>"--"</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-41-130><a id=__codelineno-41-130 name=__codelineno-41-130 href=#__codelineno-41-130></a><span class=w>                </span>sh<span class=w> </span>-c<span class=w> </span><span class=s2>"cat | PGPASSWORD='"</span><span class=si>${</span><span class=nv>postgresql_superuser_password</span><span class=si>}</span><span class=s2>"' psql -h "</span><span class=si>${</span><span class=nv>db_host</span><span class=si>}</span><span class=s2>" -p "</span><span class=si>${</span><span class=nv>db_port</span><span class=si>}</span><span class=s2>" -U "</span><span class=si>${</span><span class=nv>postgres_username</span><span class=si>}</span><span class=s2>" -d "</span><span class=si>${</span><span class=nv>database_name</span><span class=si>}</span><span class=s2>""</span>
</span><span id=__span-41-131><a id=__codelineno-41-131 name=__codelineno-41-131 href=#__codelineno-41-131></a><span class=w>        </span><span class=k>fi</span>
</span><span id=__span-41-132><a id=__codelineno-41-132 name=__codelineno-41-132 href=#__codelineno-41-132></a><span class=w>    </span><span class=k>else</span>
</span><span id=__span-41-133><a id=__codelineno-41-133 name=__codelineno-41-133 href=#__codelineno-41-133></a><span class=w>        </span><span class=c1># restore a single database</span>
</span><span id=__span-41-134><a id=__codelineno-41-134 name=__codelineno-41-134 href=#__codelineno-41-134></a><span class=w>        </span>postgresql_admin_pass
</span><span id=__span-41-135><a id=__codelineno-41-135 name=__codelineno-41-135 href=#__codelineno-41-135></a><span class=w>        </span>cat<span class=w> </span><span class=s2>"</span><span class=nv>$1</span><span class=s2>"</span><span class=w> </span><span class=p>|</span><span class=w> </span>kubectl<span class=w> </span><span class=nb>exec</span><span class=w> </span>-i<span class=w> </span>-n<span class=w> </span><span class=s2>"</span><span class=si>${</span><span class=nv>keycloak_namespace</span><span class=si>}</span><span class=s2>"</span><span class=w> </span><span class=s2>"</span><span class=si>${</span><span class=nv>postgres_pod_name</span><span class=si>}</span><span class=s2>"</span><span class=w> </span><span class=s2>"--"</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-41-136><a id=__codelineno-41-136 name=__codelineno-41-136 href=#__codelineno-41-136></a><span class=w>            </span>sh<span class=w> </span>-c<span class=w> </span><span class=s2>"cat | PGPASSWORD='"</span><span class=si>${</span><span class=nv>postgresql_admin_password</span><span class=si>}</span><span class=s2>"' psql -h "</span><span class=si>${</span><span class=nv>db_host</span><span class=si>}</span><span class=s2>" -p "</span><span class=si>${</span><span class=nv>db_port</span><span class=si>}</span><span class=s2>" -U "</span><span class=si>${</span><span class=nv>postgres_username</span><span class=si>}</span><span class=s2>" -d "</span><span class=si>${</span><span class=nv>database_name</span><span class=si>}</span><span class=s2>""</span>
</span><span id=__span-41-137><a id=__codelineno-41-137 name=__codelineno-41-137 href=#__codelineno-41-137></a><span class=w>    </span><span class=k>fi</span>
</span><span id=__span-41-138><a id=__codelineno-41-138 name=__codelineno-41-138 href=#__codelineno-41-138></a><span class=o>}</span>
</span><span id=__span-41-139><a id=__codelineno-41-139 name=__codelineno-41-139 href=#__codelineno-41-139></a>
</span><span id=__span-41-140><a id=__codelineno-41-140 name=__codelineno-41-140 href=#__codelineno-41-140></a>vacuum_pgdb<span class=o>(){</span>
</span><span id=__span-41-141><a id=__codelineno-41-141 name=__codelineno-41-141 href=#__codelineno-41-141></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>"Preparing garbage collector and analyzer"</span>
</span><span id=__span-41-142><a id=__codelineno-41-142 name=__codelineno-41-142 href=#__codelineno-41-142></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>"----------------------------------------"</span>
</span><span id=__span-41-143><a id=__codelineno-41-143 name=__codelineno-41-143 href=#__codelineno-41-143></a>
</span><span id=__span-41-144><a id=__codelineno-41-144 name=__codelineno-41-144 href=#__codelineno-41-144></a><span class=w>    </span>keycloak_ns
</span><span id=__span-41-145><a id=__codelineno-41-145 name=__codelineno-41-145 href=#__codelineno-41-145></a><span class=w>    </span>postgres_pod
</span><span id=__span-41-146><a id=__codelineno-41-146 name=__codelineno-41-146 href=#__codelineno-41-146></a><span class=w>    </span>postgres_user
</span><span id=__span-41-147><a id=__codelineno-41-147 name=__codelineno-41-147 href=#__codelineno-41-147></a><span class=w>    </span>pgdb_host_info
</span><span id=__span-41-148><a id=__codelineno-41-148 name=__codelineno-41-148 href=#__codelineno-41-148></a>
</span><span id=__span-41-149><a id=__codelineno-41-149 name=__codelineno-41-149 href=#__codelineno-41-149></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>"</span><span class=si>${</span><span class=nv>postgres_username</span><span class=si>}</span><span class=s2>"</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s1>'postgres'</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
</span><span id=__span-41-150><a id=__codelineno-41-150 name=__codelineno-41-150 href=#__codelineno-41-150></a><span class=w>        </span>postgresql_su_pass
</span><span id=__span-41-151><a id=__codelineno-41-151 name=__codelineno-41-151 href=#__codelineno-41-151></a><span class=w>        </span>kubectl<span class=w> </span><span class=nb>exec</span><span class=w> </span>-n<span class=w> </span><span class=s2>"</span><span class=si>${</span><span class=nv>keycloak_namespace</span><span class=si>}</span><span class=s2>"</span><span class=w> </span><span class=s2>"</span><span class=si>${</span><span class=nv>postgres_pod_name</span><span class=si>}</span><span class=s2>"</span><span class=w> </span><span class=s2>"--"</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-41-152><a id=__codelineno-41-152 name=__codelineno-41-152 href=#__codelineno-41-152></a><span class=w>            </span>sh<span class=w> </span>-c<span class=w> </span><span class=s2>"PGPASSWORD='"</span><span class=si>${</span><span class=nv>postgresql_superuser_password</span><span class=si>}</span><span class=s2>"' vacuumdb --analyze --all -h "</span><span class=si>${</span><span class=nv>db_host</span><span class=si>}</span><span class=s2>" -p "</span><span class=si>${</span><span class=nv>db_port</span><span class=si>}</span><span class=s2>" -U "</span><span class=si>${</span><span class=nv>postgres_username</span><span class=si>}</span><span class=s2>""</span>
</span><span id=__span-41-153><a id=__codelineno-41-153 name=__codelineno-41-153 href=#__codelineno-41-153></a><span class=w>    </span><span class=k>else</span>
</span><span id=__span-41-154><a id=__codelineno-41-154 name=__codelineno-41-154 href=#__codelineno-41-154></a><span class=w>        </span>postgresql_admin_pass
</span><span id=__span-41-155><a id=__codelineno-41-155 name=__codelineno-41-155 href=#__codelineno-41-155></a><span class=w>        </span>kubectl<span class=w> </span><span class=nb>exec</span><span class=w> </span>-n<span class=w> </span><span class=s2>"</span><span class=si>${</span><span class=nv>keycloak_namespace</span><span class=si>}</span><span class=s2>"</span><span class=w> </span><span class=s2>"</span><span class=si>${</span><span class=nv>postgres_pod_name</span><span class=si>}</span><span class=s2>"</span><span class=w> </span><span class=s2>"--"</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-41-156><a id=__codelineno-41-156 name=__codelineno-41-156 href=#__codelineno-41-156></a><span class=w>            </span>sh<span class=w> </span>-c<span class=w> </span><span class=s2>"PGPASSWORD='"</span><span class=si>${</span><span class=nv>postgresql_admin_password</span><span class=si>}</span><span class=s2>"' vacuumdb --analyze -h "</span><span class=si>${</span><span class=nv>db_host</span><span class=si>}</span><span class=s2>" -p "</span><span class=si>${</span><span class=nv>db_port</span><span class=si>}</span><span class=s2>" -U "</span><span class=si>${</span><span class=nv>postgres_username</span><span class=si>}</span><span class=s2>" -d "</span><span class=si>${</span><span class=nv>database_name</span><span class=si>}</span><span class=s2>""</span>
</span><span id=__span-41-157><a id=__codelineno-41-157 name=__codelineno-41-157 href=#__codelineno-41-157></a><span class=w>    </span><span class=k>fi</span>
</span><span id=__span-41-158><a id=__codelineno-41-158 name=__codelineno-41-158 href=#__codelineno-41-158></a><span class=o>}</span>
</span><span id=__span-41-159><a id=__codelineno-41-159 name=__codelineno-41-159 href=#__codelineno-41-159></a>
</span><span id=__span-41-160><a id=__codelineno-41-160 name=__codelineno-41-160 href=#__codelineno-41-160></a><span class=k>while</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>"</span><span class=nv>$#</span><span class=s2>"</span><span class=w> </span>-eq<span class=w> </span><span class=m>1</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>do</span>
</span><span id=__span-41-161><a id=__codelineno-41-161 name=__codelineno-41-161 href=#__codelineno-41-161></a><span class=w>    </span><span class=k>case</span><span class=w> </span><span class=s2>"</span><span class=nv>$1</span><span class=s2>"</span><span class=w> </span><span class=k>in</span>
</span><span id=__span-41-162><a id=__codelineno-41-162 name=__codelineno-41-162 href=#__codelineno-41-162></a><span class=w>        </span>-h<span class=w> </span><span class=p>|</span><span class=w> </span>--help<span class=o>)</span>
</span><span id=__span-41-163><a id=__codelineno-41-163 name=__codelineno-41-163 href=#__codelineno-41-163></a><span class=w>            </span>db_migration_help
</span><span id=__span-41-164><a id=__codelineno-41-164 name=__codelineno-41-164 href=#__codelineno-41-164></a><span class=w>            </span><span class=nb>exit</span><span class=w> </span><span class=m>0</span>
</span><span id=__span-41-165><a id=__codelineno-41-165 name=__codelineno-41-165 href=#__codelineno-41-165></a><span class=w>            </span><span class=p>;;</span>
</span><span id=__span-41-166><a id=__codelineno-41-166 name=__codelineno-41-166 href=#__codelineno-41-166></a><span class=w>        </span>-c<span class=w> </span><span class=p>|</span><span class=w> </span>--clean<span class=w> </span><span class=p>|</span><span class=w> </span>-v<span class=w> </span><span class=p>|</span><span class=w> </span>--vacuum<span class=o>)</span>
</span><span id=__span-41-167><a id=__codelineno-41-167 name=__codelineno-41-167 href=#__codelineno-41-167></a><span class=w>            </span>vacuum_pgdb
</span><span id=__span-41-168><a id=__codelineno-41-168 name=__codelineno-41-168 href=#__codelineno-41-168></a><span class=w>            </span><span class=nb>exit</span><span class=w> </span><span class=m>0</span>
</span><span id=__span-41-169><a id=__codelineno-41-169 name=__codelineno-41-169 href=#__codelineno-41-169></a><span class=w>            </span><span class=p>;;</span>
</span><span id=__span-41-170><a id=__codelineno-41-170 name=__codelineno-41-170 href=#__codelineno-41-170></a><span class=w>        </span>--<span class=o>)</span>
</span><span id=__span-41-171><a id=__codelineno-41-171 name=__codelineno-41-171 href=#__codelineno-41-171></a><span class=w>            </span><span class=k>break</span>
</span><span id=__span-41-172><a id=__codelineno-41-172 name=__codelineno-41-172 href=#__codelineno-41-172></a><span class=w>            </span><span class=p>;;</span>
</span><span id=__span-41-173><a id=__codelineno-41-173 name=__codelineno-41-173 href=#__codelineno-41-173></a><span class=w>        </span>-*<span class=o>)</span>
</span><span id=__span-41-174><a id=__codelineno-41-174 name=__codelineno-41-174 href=#__codelineno-41-174></a><span class=w>            </span><span class=nb>echo</span><span class=w> </span><span class=s2>"Invalid option '</span><span class=nv>$1</span><span class=s2>'. Use -h|--help to see the valid options"</span><span class=w> </span>&gt;<span class=p>&amp;</span><span class=m>2</span>
</span><span id=__span-41-175><a id=__codelineno-41-175 name=__codelineno-41-175 href=#__codelineno-41-175></a><span class=w>            </span><span class=nb>exit</span><span class=w> </span><span class=m>1</span>
</span><span id=__span-41-176><a id=__codelineno-41-176 name=__codelineno-41-176 href=#__codelineno-41-176></a><span class=w>            </span><span class=p>;;</span>
</span><span id=__span-41-177><a id=__codelineno-41-177 name=__codelineno-41-177 href=#__codelineno-41-177></a><span class=w>        </span>*<span class=o>)</span>
</span><span id=__span-41-178><a id=__codelineno-41-178 name=__codelineno-41-178 href=#__codelineno-41-178></a><span class=w>            </span>keycloak_pgdb_import<span class=w> </span><span class=s2>"</span><span class=nv>$1</span><span class=s2>"</span>
</span><span id=__span-41-179><a id=__codelineno-41-179 name=__codelineno-41-179 href=#__codelineno-41-179></a><span class=w>            </span><span class=nb>exit</span><span class=w> </span><span class=m>0</span>
</span><span id=__span-41-180><a id=__codelineno-41-180 name=__codelineno-41-180 href=#__codelineno-41-180></a><span class=w>            </span><span class=p>;;</span>
</span><span id=__span-41-181><a id=__codelineno-41-181 name=__codelineno-41-181 href=#__codelineno-41-181></a><span class=w>    </span><span class=k>esac</span>
</span><span id=__span-41-182><a id=__codelineno-41-182 name=__codelineno-41-182 href=#__codelineno-41-182></a><span class=w>    </span><span class=nb>shift</span>
</span><span id=__span-41-183><a id=__codelineno-41-183 name=__codelineno-41-183 href=#__codelineno-41-183></a><span class=k>done</span>
</span><span id=__span-41-184><a id=__codelineno-41-184 name=__codelineno-41-184 href=#__codelineno-41-184></a>
</span><span id=__span-41-185><a id=__codelineno-41-185 name=__codelineno-41-185 href=#__codelineno-41-185></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>"</span><span class=nv>$#</span><span class=s2>"</span><span class=w> </span>-gt<span class=w> </span><span class=m>1</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
</span><span id=__span-41-186><a id=__codelineno-41-186 name=__codelineno-41-186 href=#__codelineno-41-186></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>"Please pass a single file to the script"</span>
</span><span id=__span-41-187><a id=__codelineno-41-187 name=__codelineno-41-187 href=#__codelineno-41-187></a><span class=w>    </span><span class=nb>exit</span><span class=w> </span><span class=m>1</span>
</span><span id=__span-41-188><a id=__codelineno-41-188 name=__codelineno-41-188 href=#__codelineno-41-188></a><span class=k>fi</span>
</span><span id=__span-41-189><a id=__codelineno-41-189 name=__codelineno-41-189 href=#__codelineno-41-189></a>
</span><span id=__span-41-190><a id=__codelineno-41-190 name=__codelineno-41-190 href=#__codelineno-41-190></a><span class=nb>echo</span><span class=w> </span><span class=s2>"Preparing Export"</span>
</span><span id=__span-41-191><a id=__codelineno-41-191 name=__codelineno-41-191 href=#__codelineno-41-191></a><span class=nb>echo</span><span class=w> </span><span class=s2>"----------------"</span>
</span><span id=__span-41-192><a id=__codelineno-41-192 name=__codelineno-41-192 href=#__codelineno-41-192></a>keycloak_ns
</span><span id=__span-41-193><a id=__codelineno-41-193 name=__codelineno-41-193 href=#__codelineno-41-193></a>postgres_pod
</span><span id=__span-41-194><a id=__codelineno-41-194 name=__codelineno-41-194 href=#__codelineno-41-194></a>postgres_user
</span><span id=__span-41-195><a id=__codelineno-41-195 name=__codelineno-41-195 href=#__codelineno-41-195></a>pgdb_host_info
</span><span id=__span-41-196><a id=__codelineno-41-196 name=__codelineno-41-196 href=#__codelineno-41-196></a>keycloak_pgdb_export
</span></code></pre></div> </details> <h2 id=related-articles>Related Articles<a class=headerlink href=#related-articles title="Permanent link">âš“ï¸Ž</a></h2> <ul> <li><a href=../deploy-okd-4.10/ >Deploy OKD 4.10 Cluster</a></li> </ul></div> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title="Last update"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1-2.1-2M12.5 7v5.2l4 2.4-1 1L11 13V7h1.5M11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2v1.8Z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">February 21, 2024</span> </span> <span class=md-source-file__fact> <span class=md-icon title=Created> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3h-2Z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">August 23, 2022</span> </span> <span class=md-source-file__fact> <span class=md-icon title=Contributors> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg> </span> <span>GitHub</span> <nav> <a href=https://github.com/Oleksandr123234 class=md-author title=@Oleksandr123234> <img src="https://avatars.githubusercontent.com/u/131377149?v=4&size=72" alt=Oleksandr123234> </a> <a href=https://github.com/YevheniiPokhvalii class=md-author title=@YevheniiPokhvalii> <img src="https://avatars.githubusercontent.com/u/68227075?v=4&size=72" alt=YevheniiPokhvalii> </a> </nav> </span> </aside> <form class=md-feedback name=feedback hidden> <fieldset> <legend class=md-feedback__title> Was this page helpful? </legend> <div class=md-feedback__inner> <div class=md-feedback__list> <button class="md-feedback__icon md-icon" type=submit title="This page was helpful" data-md-value=1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m7 0c0 .8-.7 1.5-1.5 1.5S14 10.3 14 9.5 14.7 8 15.5 8s1.5.7 1.5 1.5m-5 7.73c-1.75 0-3.29-.73-4.19-1.81L9.23 14c.45.72 1.52 1.23 2.77 1.23s2.32-.51 2.77-1.23l1.42 1.42c-.9 1.08-2.44 1.81-4.19 1.81Z"/></svg> </button> <button class="md-feedback__icon md-icon" type=submit title="This page could be improved" data-md-value=0> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10m-6.5-4c.8 0 1.5.7 1.5 1.5s-.7 1.5-1.5 1.5-1.5-.7-1.5-1.5.7-1.5 1.5-1.5M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m2 4.5c1.75 0 3.29.72 4.19 1.81l-1.42 1.42C14.32 16.5 13.25 16 12 16s-2.32.5-2.77 1.23l-1.42-1.42C8.71 14.72 10.25 14 12 14Z"/></svg> </button> </div> <div class=md-feedback__note> <div data-md-value=1 hidden> Thanks for your feedback! </div> <div data-md-value=0 hidden> Thanks for your feedback! Help us improve this page by using our <a href=... target=_blank rel=noopener>feedback form</a>. </div> </div> </div> </fieldset> </form> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../upgrade-edp-3.1/ class="md-footer__link md-footer__link--prev" aria-label="Previous: v3.0 to 3.1"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> v3.0 to 3.1 </div> </div> </a> <a href=../../user-guide/terraform-stages/ class="md-footer__link md-footer__link--next" aria-label="Next: CI Pipelines for Terraform"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> CI Pipelines for Terraform </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <!-- Copyright and theme information --> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2018 - 2024 EPAM Delivery Platform - <a href=#__consent>Change cookie settings</a> </div> powered by <a href=https://www.mkdocs.org title=MkDocs>MkDocs</a> and <a href=https://squidfunk.github.io/mkdocs-material/ title="Material for MkDocs"> Material for MkDocs</a> </div> <div class=md-social> <a href=https://www.youtube.com/@theplatformteam target=_blank rel=noopener title=www.youtube.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 576 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"/></svg> </a> <a href=https://medium.com/epam-delivery-platform target=_blank rel=noopener title=medium.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 640 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M180.5 74.262C80.813 74.262 0 155.633 0 256s80.819 181.738 180.5 181.738S361 356.373 361 256 280.191 74.262 180.5 74.262Zm288.25 10.646c-49.845 0-90.245 76.619-90.245 171.095s40.406 171.1 90.251 171.1 90.251-76.619 90.251-171.1H559c0-94.503-40.4-171.095-90.248-171.095Zm139.506 17.821c-17.526 0-31.735 68.628-31.735 153.274s14.2 153.274 31.735 153.274S640 340.631 640 256c0-84.649-14.215-153.271-31.742-153.271Z"/></svg> </a> <a href=https://hub.docker.com/u/epamedp target=_blank rel=noopener title=hub.docker.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 640 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M349.9 236.3h-66.1v-59.4h66.1v59.4zm0-204.3h-66.1v60.7h66.1V32zm78.2 144.8H362v59.4h66.1v-59.4zm-156.3-72.1h-66.1v60.1h66.1v-60.1zm78.1 0h-66.1v60.1h66.1v-60.1zm276.8 100c-14.4-9.7-47.6-13.2-73.1-8.4-3.3-24-16.7-44.9-41.1-63.7l-14-9.3-9.3 14c-18.4 27.8-23.4 73.6-3.7 103.8-8.7 4.7-25.8 11.1-48.4 10.7H2.4c-8.7 50.8 5.8 116.8 44 162.1 37.1 43.9 92.7 66.2 165.4 66.2 157.4 0 273.9-72.5 328.4-204.2 21.4.4 67.6.1 91.3-45.2 1.5-2.5 6.6-13.2 8.5-17.1l-13.3-8.9zm-511.1-27.9h-66v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm-78.1-72.1h-66.1v60.1h66.1v-60.1z"/></svg> </a> <a href=mailto:SupportEPMD-EDP@epam.com target=_blank rel=noopener title class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M498.1 5.6c10.1 7 15.4 19.1 13.5 31.2l-64 416c-1.5 9.7-7.4 18.2-16 23s-18.9 5.4-28 1.6L284 427.7l-68.5 74.1c-8.9 9.7-22.9 12.9-35.2 8.1S160 493.2 160 480v-83.6c0-4 1.5-7.8 4.2-10.7l167.6-182.9c5.8-6.3 5.6-16-.4-22s-15.7-6.4-22-.7L106 360.8l-88.3-44.2C7.1 311.3.3 300.7 0 288.9s5.9-22.8 16.1-28.7l448-256c10.7-6.1 23.9-5.5 34 1.4z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-consent data-md-component=consent id=__consent hidden> <div class=md-consent__overlay></div> <aside class=md-consent__inner> <form class="md-consent__form md-grid md-typeset" name=consent> <h4>Cookie consent</h4> <p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p> <input class=md-toggle type=checkbox id=__settings checked> <div class=md-consent__settings> <ul class=task-list> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=analytics checked> <span class=task-list-indicator></span> Google Analytics </label> </li> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=github checked> <span class=task-list-indicator></span> GitHub </label> </li> </ul> </div> <div class=md-consent__controls> <button class="md-button md-button--primary">Accept</button> <button type=reset class="md-button md-button--primary">Reject</button> </div> </form> </aside> </div> <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout(function(){document.querySelector("[data-md-component=consent]").hidden=!1},250);var action,form=document.forms.consent;for(action of["submit","reset"])form.addEventListener(action,function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map(function(e){return[e,!0]}))),location.hash="",location.reload()})</script> <script id=__config type=application/json>{"base": "../..", "features": ["content.code.annotate", "content.code.copy", "content.code.select", "navigation.footer", "navigation.sections", "navigation.tabs", "navigation.top", "search.highlight", "search.share", "search.suggest"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../../assets/javascripts/bundle.caa56a14.min.js></script> <script src=https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js></script> <script src=https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js></script> <script src=https://cdnjs.cloudflare.com/ajax/libs/bodymovin/5.6.6/lottie.min.js></script> <script src=../../overrides/animation.js></script> </body> </html>